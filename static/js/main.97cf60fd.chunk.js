(this.webpackJsonpsavemevideotest=this.webpackJsonpsavemevideotest||[]).push([[0],{480:function(e,t,a){},525:function(e,t){},550:function(e,t){},551:function(e,t){},559:function(e,t){},562:function(e,t){},563:function(e,t){},564:function(e,t){},569:function(e,t,a){var n=a(251),i=a(252),s=function(){"use strict";function e(t){n(this,e),this.streamId=t,this.totalBytesReceivedCount=0,this.totalBytesSent=0,this.videoPacketsLost=0,this.fractionLost=0,this.startTime=0,this.lastFramesEncoded=0,this.totalFramesEncodedCount=0,this.lastBytesReceived=0,this.lastBytesSent=0,this.currentTimestamp=0,this.lastTime=0,this.timerId=0,this.firstByteSentCount=0,this.firstBytesReceivedCount=0,this.audioLevel=-1,this.qualityLimitationReason="",this.resWidth=0,this.resHeight=0,this.srcFps=0,this.frameWidth=0,this.frameHeight=0,this.videoRoundTripTime=0,this.videoJitter=0,this.audioRoundTripTime=0,this.audioJitter=0,this.audioPacketsLost=0,this.framesReceived=0,this.framesDropped=0,this.framesDecoded=0,this.audioJitterAverageDelay=0,this.videoJitterAverageDelay=0}return i(e,[{key:"averageOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.firstByteSentCount)/(this.currentTimestamp-this.startTime))}},{key:"currentFPS",get:function(){return((this.totalFramesEncodedCount-this.lastFramesEncoded)/(this.currentTimestamp-this.lastTime)*1e3).toFixed(1)}},{key:"averageIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.firstBytesReceivedCount)/(this.currentTimestamp-this.startTime))}},{key:"currentOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.lastBytesSent)/(this.currentTimestamp-this.lastTime))}},{key:"currentIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.lastBytesReceived)/(this.currentTimestamp-this.lastTime))}},{key:"currentTime",set:function(e){this.lastTime=this.currentTimestamp,this.currentTimestamp=e,0==this.startTime&&(this.startTime=e-1)}},{key:"totalBytesReceived",set:function(e){this.lastBytesReceived=this.totalBytesReceivedCount,this.totalBytesReceivedCount=e,0==this.firstBytesReceivedCount&&(this.firstBytesReceivedCount=e)}},{key:"totalBytesSent",set:function(e){this.lastBytesSent=this.totalBytesSentCount,this.totalBytesSentCount=e,0==this.firstByteSentCount&&(this.firstByteSentCount=e)}},{key:"totalFramesEncoded",set:function(e){this.lastFramesEncoded=this.totalFramesEncodedCount,this.totalFramesEncodedCount=e,0==this.lastFramesEncoded&&(this.lastFramesEncoded=e)}}]),e}();e.exports=s},570:function(e,t,a){var n=a(251),i=a(252),s=function(){"use strict";function e(t,a,i,s){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n(this,e),this.streams=[],this.width=t,this.height=a;var r=window.AudioContext||window.webkitAudioContext;this.audioCtx=new r,this.audioDestination=this.audioCtx.createMediaStreamDestination(),this.autoMode=i,this.aspectRatio=s,this.stream_height=a,this.stream_width=t,this.pwidth=0,this.pheight=0,this.vwidth=0,this.wheight=0,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this.ctx=this.canvas.getContext("2d"),this.streamCount=0,this.frameCount=0,this.videoSyncDelayNode=this.audioCtx.createDelay(5),this.videoSyncDelayNode.connect(this.audioDestination),this.started=!1,this.fps=30,this.recordingEnabled=o}return i(e,[{key:"changeAspectRatio",value:function(e){this.aspectRatio=e,console.log("Changing aspect ratio to: "+e),this.resizeAndSortV2()}},{key:"changeStreamSize",value:function(e){this.stream_height=e,console.log("Changing merged streams size to = "+e+"p"),this.resizeAndSortV2()}},{key:"getResult",value:function(){return this.result}},{key:"addStream",value:function(e,t){var a=this;this.streamCount++;var n={};this.audioCtx.resume(),n.streamId=t.streamId,n.width=t.width||150,n.height=t.height||150,n.Xindex=t.Xindex||0,n.Yindex=t.Yindex||0,n.portrait=!1,n.aspectRatio=4/3,void 0==t.x?n.x=n.width*n.Xindex:n.x=t.x,void 0==t.x?n.y=n.height*n.Yindex:n.y=t.y,console.debug(n.width,n.Xindex,n.x),n.mute=t.mute||!1;var i=null;(i=document.createElement("video")).autoplay=!0,i.muted=!0,i.srcObject=e,i.setAttribute("style","position:fixed; left: 0px; top:0px;z-index:99;pointer-events: none; opacity:0;"),document.body.appendChild(i),n.mute||(n.audioSource=this.audioCtx.createMediaStreamSource(e),n.audioGainNode=this.audioCtx.createGain(),n.audioGainNode.gain.value=1,n.audioSource.connect(n.audioGainNode).connect(this.audioDestination)),n.element=i,this.streams.push(n),1==this.autoMode&&(this.resizeAndSortV2(),i.onloadedmetadata=function(){if(console.debug("streamId = "+n.streamId),e.getVideoTracks()[0].getSettings().height>e.getVideoTracks()[0].getSettings().width){console.debug("portrait mode");var t=(n.width-a.pwidth)/2;n.portrait=!0,n.x+=t,n.width=a.pwidth,n.height=a.pheight,console.log("Location offset from metadata x = "+n.x+" y = "+n.y)}})}},{key:"requestAnimationFrameV2",value:function(e){var t=!1,a=setInterval((function(){!t&&document.hidden&&(t=!0,clearInterval(a),e())}),1e3/this.fps);requestAnimationFrame((function(){t||(t=!0,clearInterval(a),e())}))}},{key:"resizeAndSortV2",value:function(){this.ctx.clearRect(0,0,this.width,this.height),console.log("Sorting the streams");for(var e=0,t=0,a=0,n=0,i=0,s=0,o=this.streams.length,r=0,c=0,d=0,l=0,u=0,m=1;m<=5;m++)if(this.streams.length<=m*m){if(d=m,m*(m-1)>=this.streams.length&&this.streams.length>2){if(a=m-1,this.height=this.stream_height*a,"16:9"==this.aspectRatio){var h=this.stream_height/9*16;this.width=h*a}else{var p=this.stream_height/3*4;this.width=p*a}if(l=this.stream_height*a,"16:9"==this.aspectRatio)u=this.stream_height/16*9*a;else u=this.stream_height/4*3*a}else{if(a=m,this.height=this.stream_height*a,"16:9"==this.aspectRatio){var v=this.stream_height/9*16;this.width=v*a}else{var f=this.stream_height/3*4;this.width=f*a}if(l=this.stream_height*a,"16:9"==this.aspectRatio)u=this.stream_height/16*9*a;else u=this.stream_height/4*3*a}break}this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),console.log("Row number = "+a),console.log("canvas width = "+this.width+"canvas height = "+this.height);for(var g=this.streams.length-a*a,b=0,w=1;w<=this.streams.length;w++){console.log("extraStreams = "+g+" stream length = "+this.streams.length),console.log("Xindex = "+e+"Yindex = "+t);var y=this.streams[w-1];if(g<=0||this.streams.length<=3){if(this.pwidth=u/d,this.pheight=l/d,this.vwidth=this.width/d,this.vheight=this.height/d,1==y.portrait){y.width=this.pwidth,y.height=this.pheight,y.x=this.vwidth*e,y.y=this.vheight*t-c;var k=(this.vwidth-this.pwidth)/2;y.x+=k}else y.width=this.vwidth,y.height=this.vheight,y.x=this.vwidth*e,y.y=this.vheight*t-c;b+=this.width/d,console.log("Video width = "+y.width+"Video height = "+y.height),0==e&&(i+=y.height,console.debug("CropHeight = "+i)),e++,t>=a-1&&1!=this.streams.length&&(console.log("TopWidth = "+s+" remainingStreams = "+o),r=(s-this.vwidth*o)/2,y.x+=r),e>=a&&(e=0,s=b,b=0,t++,o-=a)}else{if(this.pwidth=u/(d+1),this.pheight=l/(d+1),this.vwidth=this.width/(d+1),this.vheight=this.height/(d+1),1==y.portrait){y.width=this.pwidth,y.height=this.pheight,y.x=this.vwidth*e,y.y=this.vheight*t;var S=(this.vwidth-this.pwidth)/2;y.x+=S}else y.width=this.vwidth,y.height=this.vheight,y.x=this.vwidth*e,y.y=this.vheight*t;n+=this.width/(d+1),console.log("Video Width = "+y.width+"VideoHeight = "+y.height),0==e&&(i+=y.height,console.debug("CropHeight = "+i)),++e>a&&(c=this.height/d-y.height,e=0,t++,r=this.width-n,this.canvas.setAttribute("width",n),console.log("New canvas width= "+n),s=n,n=0,g--,o-=a+1)}}this.canvas.setAttribute("height",i)}},{key:"start",value:function(){this.started=!0,this.requestAnimationFrameV2(this.draw.bind(this)),this.result=this.canvas.captureStream(this.fps);var e=this.result.getAudioTracks()[0];e&&this.result.removeTrack(e);var t=this.audioDestination.stream.getAudioTracks();this.result.addTrack(t[0])}},{key:"draw",value:function(){var e=this;if(this.started){this.frameCount++;var t=this.streams.length,a=function(){--t<=0&&e.requestAnimationFrameV2(e.draw.bind(e))};this.streams.forEach((function(t){var n=t.width,i=t.height;e.ctx.drawImage(t.element,t.x,t.y,n,i),a()})),0===this.streams.length&&a()}}},{key:"muteStream",value:function(e){for(var t=0;t<this.streams.length;t++){var a=this.streams[t];e===a.streamId&&(a.element&&0==a.mute?(a.audioGainNode.gain.value=0,a.mute=!0):a.element&&1==a.mute&&(a.audioGainNode.gain.value=1,a.mute=!1))}}},{key:"removeStream",value:function(e){for(var t=0;t<this.streams.length;t++){var a=this.streams[t];e===a.streamId&&(a.element&&a.element.remove(),!0,this.streams[t]=null,this.streams.splice(t,1),t--)}console.log("removed streamId = "+e),1==this.autoMode&&this.resizeAndSortV2()}},{key:"stop",value:function(){this.started=!1,this.streams.forEach((function(e){e.element&&e.element.remove()})),this.streams=[],this.audioCtx.close(),this.audioCtx=null,this.audioDestination=null,this.videoSyncDelayNode=null,this.result.getTracks().forEach((function(e){e.stop()})),this.result=null}}]),e}();e.exports=s},571:function(e,t,a){var n=a(251),i=a(252),s=function(){"use strict";function e(t){var a=this;for(var i in n(this,e),t)t.hasOwnProperty(i)&&(this[i]=t[i]);this.wsConn=new WebSocket(this.websocket_url),this.isWebSocketTriggered=!0,this.connected=!1,this.pingTimerId=-1,this.wsConn.onopen=function(){console.log("websocket connected"),a.pingTimerId=setInterval((function(){a.sendPing()}),3e3),a.connected=!0,a.callback("initialized")},this.wsConn.onmessage=function(e){var t=JSON.parse(e.data);"start"==t.command?(a.debug&&console.debug("received start command"),a.webrtcadaptor.startPublishing(t.streamId)):"takeCandidate"==t.command?(a.debug&&(console.debug("received ice candidate for stream id "+t.streamId),console.debug(t.candidate)),a.webrtcadaptor.takeCandidate(t.streamId,t.label,t.candidate)):"takeConfiguration"==t.command?(a.debug&&console.log("received remote description type for stream id: "+t.streamId+" type: "+t.type),a.webrtcadaptor.takeConfiguration(t.streamId,t.sdp,t.type)):"stop"==t.command?(console.debug("Stop command received"),a.webrtcadaptor.closePeerConnection(t.streamId)):"error"==t.command?a.callbackError(t.definition):"notification"==t.command?(a.callback(t.definition,t),"play_finished"!=t.definition&&"publish_finished"!=t.definition||a.webrtcadaptor.closePeerConnection(t.streamId)):"streamInformation"==t.command||"roomInformation"==t.command?a.callback(t.command,t):"pong"==t.command?a.callback(t.command):"trackList"==t.command?a.callback(t.command,t):"connectWithNewId"==t.command?(a.multiPeerStreamId=t.streamId,a.join(t.streamId)):"peerMessageCommand"==t.command&&a.callback(t.command,t)},this.wsConn.onerror=function(e){console.log(" error occured: "+JSON.stringify(e)),a.clearPingTimer(),a.callbackError(e)},this.wsConn.onclose=function(e){a.connected=!1,console.log("connection closed."),a.clearPingTimer(),a.callback("closed",e)}}return i(e,[{key:"clearPingTimer",value:function(){-1!=this.pingTimerId&&(this.debug&&console.debug("Clearing ping message timer"),clearInterval(this.pingTimerId),this.pingTimerId=-1)}},{key:"sendPing",value:function(){this.wsConn.send(JSON.stringify({command:"ping"}))}},{key:"close",value:function(){this.wsConn.close()}},{key:"send",value:function(e){0!=this.wsConn.readyState&&2!=this.wsConn.readyState&&3!=this.wsConn.readyState?this.wsConn.send(e):this.callbackError("WebSocketNotConnected")}},{key:"isConnected",value:function(){return this.connected}}]),e}();e.exports=s},591:function(e,t){},616:function(e,t,a){},617:function(e,t,a){},618:function(e,t,a){},620:function(e,t,a){},621:function(e,t,a){},622:function(e,t,a){},69:function(e){e.exports=JSON.parse('{"a":"/save-me-videotest1.1","c":"https://saveme.ai/save-me-api","b":"https://saveme.ai/antmedia/d2/api","f":"6166aede3b8e2a6ceb59ff5d","d":"eGPH8fzbqH6f4Hnh","e":"save-me-api"}')},698:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a.n(n),s=a(67),o=a.n(s),r=a(7),c=a(12),d=a(15),l=a(16),u=(a(480),a(481),a(69)),m=a(23),h=a(8),p=a(3),v=a.n(p),f=a(14),g=a(247),b=a(150),w=a(130),y=a(80),k=a(331),S=a(245),j=a(460),x=a(462),C=a(461),O=a(190),T=a(428),I=a.n(T),N=a(70),_=a.n(N),A=a(429),M=a.n(A),R=a(711),E=a(474),D=a(470),P=a(322),V=a(712),B=a(714),L=a(709),U=a(715),F=a(707),H=a(710),J=a(125),W=a(704),G=a(705),z=a(706),q=a(149),Y=a.n(q),X=a(341),Z=a.n(X),$=a(713),Q=a(430),K=a.n(Q),ee=(a(371),a(697),a(99)),te=(a(616),a(617),a(618),a.p+"static/media/user.37c82b98.png"),ae=a(11),ne=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).componentDidMount=Object(f.a)(v.a.mark((function e(){var t,a,i,s,o,r,c,d,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,a=t.streamId,i=t.videoTrack,s=n.state.mediaStream,o=a.replace("ARDAMSv",""),(r=window.webRTCAdaptor.multiStream.getTrackById("ARDAMSa"+o))&&(s.addTrack(r),s.addTrack(i)),e.next=7,n.setState({mediaStream:s,streamId:o});case 7:return e.next=9,Y.a.get("https://prematix.tech/WebRTCAppEE/rest/v2/broadcasts/".concat(o));case 9:return c=e.sent,d=JSON.parse(c.data.name),l=d.hasOwnProperty("username")?d.username:null,e.next=14,n.setState({userName:l});case 14:return n.props.notifyUser("".concat(n.state.userName," Joined ...")),n.props.ledger.handRiseEvents.hasOwnProperty(n.state.streamId)&&n.props.raiseIfRequired("handRaise",n.props.ledger.handRiseEvents[n.state.streamId]),e.next=19,Object(ee.checkMicSensitivity)(n.state.mediaStream,n.state.streamId);case 19:case"end":return e.stop()}}),e)}))),n.state={streamId:null,userName:null,mediaStream:new MediaStream},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this.state,t=e.streamId,a=e.userName,n=e.mediaStream;return Object(ae.jsx)("div",{className:"antsdk-remote-video-data",id:"player".concat(t),onContextMenu:function(e){return e.preventDefault()},children:Object(ae.jsxs)("div",{className:"antsdk-remote-video-content",children:[Object(ae.jsx)("video",{className:"antsdk-remote-video-tag",ref:function(e){return e?e.srcObject=n:e},poster:te,id:"remoteVideo".concat(t),autoPlay:!0,playsInline:!0}),Object(ae.jsx)("div",{className:"antsdk-remote-video-speaker",id:"remoteSpeaker".concat(t)}),Object(ae.jsxs)("div",{className:"antsdk-remote-video-user-details",children:[Object(ae.jsx)("span",{title:"".concat(a),className:"antsdk-remote-video-username",id:"userName".concat(t),children:a||"Guest"}),Object(ae.jsx)("i",{className:"antsdk-remote-video-mic-icon antsdk-remote-video-mic-icon-unmute",id:"munmute".concat(t),style:{display:"block"},children:Object(ae.jsx)(y.c,{})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-mic-icon antsdk-remote-video-mic-icon-mute",id:"mmute".concat(t),style:{display:"none"},children:Object(ae.jsx)(y.d,{})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-handraise-icon antsdk-remote-video-handraise-icon-handraise",id:"Hand".concat(t),style:{display:"none"},children:Object(ae.jsx)(w.a,{style:{color:"#ffc800"}})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-handraise-icon antsdk-remote-video-handraise-icon-thumbsup",id:"Thumbsup".concat(t),style:{display:"none"},children:Object(ae.jsx)(b.a,{className:"ml-2",style:{color:"#ffc800"}})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-handraise-icon antsdk-remote-video-handraise-icon-heart",id:"Heart".concat(t),style:{display:"none"},children:Object(ae.jsx)(w.b,{style:{color:"#ff0000"}})})]})]})})}}]),a}(n.PureComponent),ie=(a(620),function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(e){return Object(r.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){var e,t,a=this,n=this.props.MediaStreamList;return Object(ae.jsxs)("div",{className:"participant-list-all",children:[Object(ae.jsxs)("h4",{className:"participant-heading",children:[n?(null===(e=Object.keys(n))||void 0===e?void 0:e.length)+1:0," Participants",Object(ae.jsx)("div",{className:"participant-close",onClick:function(){return a.props.onToogleParticipant()},children:Object(ae.jsx)(b.b,{})})]}),Object(ae.jsx)("div",{className:"list-wrapper",children:Object(ae.jsxs)("ul",{className:"list",children:[window.UserName&&Object(ae.jsxs)("li",{className:"list-item",children:[Object(ae.jsx)("div",{className:"user-name-logo",children:Object(ae.jsx)("div",{className:"user-name-letter",children:window.UserName[0]})}),Object(ae.jsx)("div",{className:"list-item-content",children:Object(ae.jsx)("h4",{className:"list-name",children:window.UserName})})]}),n&&(null===(t=Object.values(n))||void 0===t?void 0:t.map((function(e,t){var a;return Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsxs)("li",{className:"list-item",children:[Object(ae.jsx)("div",{className:"user-name-logo",children:Object(ae.jsx)("div",{className:"user-name-letter",children:null===(a=e.userName)||void 0===a?void 0:a[0]})}),Object(ae.jsx)("div",{className:"list-item-content",children:Object(ae.jsx)("h4",{className:"list-name",children:e.userName})})]},t)})})))]})})]})}}]),a}(n.Component)),se=a(343),oe=a(345),re=a(26),ce=a.n(re),de=(a(621),["fieldState","fieldApi","faClass"]),le=["field","onChange","onBlur","initialValue","forwardedRef","className","content"];var ue=Object(J.e)((function(e){var t,a=e.fieldState,i=e.fieldApi,s=e.faClass,o=Object(oe.a)(e,de),r=a.value,c=i.setValue,d=i.setTouched,l=o.field,u=o.onChange,m=o.onBlur,h=(o.initialValue,o.forwardedRef),p=o.className,v=o.content,f=Object(oe.a)(o,le);function g(e){t=e,u&&o.onChange(t)}return Object(ae.jsx)(n.Fragment,{children:Object(ae.jsx)("div",{className:"videoUploader",style:{position:"absolute"},children:Object(ae.jsxs)("div",{className:"form-group",children:[s&&Object(ae.jsx)("i",{className:s}),o.label&&Object(ae.jsxs)("label",{htmlFor:l,className:"label",children:[o.label,o.required&&Object(ae.jsx)("i",{style:{color:"red"},children:"*"})]}),Object(ae.jsx)("input",Object(se.a)(Object(se.a)({},f),{},{id:l,ref:h,type:"file",required:!1,value:r||0===r?r:"",className:ce()("form-control ".concat(p),{"is-invalid":a.error}),onChange:function(e){g(e),c(e.target.value)},onBlur:function(e){d(!0),m&&m(e)}})),o.helper&&Object(ae.jsx)("small",{className:"form-text text-muted",children:v}),a.error?Object(ae.jsx)("div",{className:"invalid-field",children:a.error}):null,t&&Object(ae.jsx)("img",{id:"MainContent_imgBtRtPrev",alt:"Select File",title:"Select File",src:t.target.value,style:{width:"150px",height:"150px"}})]})})})})),me={get:Y.a.get,post:Y.a.post,put:Y.a.put,delete:Y.a.delete},he=new(a(473).a),pe=function(e){return he.get(e)},ve=function(e,t,a){var n="".concat(u.c,"/sms");return me.post("".concat(n),{MobileNumber:"".concat(e),Details:"".concat(t),Link:"".concat(a)},{headers:{"x-api-key":"".concat(u.e)}})},fe=function(e,t,a){var n="".concat(u.c,"/Email?mail_content=").concat(e,"&emailId=").concat(t,"&subject=").concat(a);return me.post("".concat(n))},ge=function(){var e=Object(f.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(u.c,"/getDoctorBasedOnName?Count=10&DoctorName=").concat(t),e.abrupt("return",me.get("".concat(a)));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=Object(f.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(u.b,"/createRoom?roomName=").concat(t),e.next=3,me.get("".concat(a,"\u200b\u200b\u200b\u200b\u200b"),{headers:{Authorization:"".concat(u.f)}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we=a.p+"static/media/bgImage.da6a0ec0.svg",ye=a.p+"static/media/screen.aa1f7ec7.svg",ke=(a(622),function(){return Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsx)("div",{className:"chat-ticontainer",children:Object(ae.jsxs)("div",{className:"chat-tiblock",children:[Object(ae.jsx)("div",{className:"chat-tidot"}),Object(ae.jsx)("div",{className:"chat-tidot"}),Object(ae.jsx)("div",{className:"chat-tidot"})]})})})});function Se(e,t,a,n){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,s=0,o=0,r=.75*e+2*i;s<t;)o+e>a&&(o=0,r=r+.75*e+2*i),o=o+e+2*i,s++;return!(r>n)&&e}function je(){var e=document.getElementById("players");if(e){for(var t=e.offsetWidth-4,a=e.offsetHeight-4,n=document.getElementsByClassName("antsdk-remote-video-data"),i=0,s=1;s<5e3;){if(!1===Se(s,n.length,t,a,2)){i=s-1;break}s++}(function(e,t){for(var a=document.getElementsByClassName("antsdk-remote-video-data"),n=0;n<a.length;n++)a[n].style.width=e+"px",a[n].style.margin=t+"px",a[n].style.height=.75*e+"px"})(i-=4,2)}}window.webRTCAdaptor=void 0,window.roomId=void 0,window.publishStreamId=void 0,window.UserName=void 0,window.roomTimerId=void 0,window.userList=void 0;var xe=R.a.Option,Ce=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).openNotification=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"bottomRight";E.a.open({message:e,description:t,placement:a,className:"ant-notify-class"})},n.navigateToDashboard=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="https://saveme.ai/whiteboard/".concat(n.state.ConsultationId),window.open(t,"Save-Me DashBoard");case 2:case"end":return e.stop()}}),e)}))),n.customCallback=function(){var e=Object(f.a)(v.a.mark((function e(t,a){var i,s,o,r,c,d,l,u,p,f,g,b,w,y,k,S,j,x,C,O,T,I,N,A,M,R,D,P,V,B,L,U,F,H,J,W,G,z,q,Y,X,$,Q,K,te,ne,ie,se,oe,re,ce,de,le,ue,me,he,pe;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(null===(i=window.webRTCAdaptor)||void 0===i?void 0:i.MediaStreamList)||{},c=(null===(s=window.webRTCAdaptor)||void 0===s?void 0:s.multiStream)||new MediaStream,e.t0=t,e.next="chatHistory"===e.t0?5:"createMessage"===e.t0?9:"File"===e.t0?12:"createReplyMessage"===e.t0?16:"createReplyFileMessage"===e.t0?20:"messageSent"===e.t0?24:"messageReceived"===e.t0?28:"messageSeen"===e.t0?32:"typing"===e.t0?34:"typingEnd"===e.t0?37:"pong"===e.t0?40:"available_devices"===e.t0?41:"initialized"===e.t0?42:"joinedTheRoom"===e.t0?45:"newStreamAvailable"===e.t0?53:"publish_started"===e.t0?60:"publish_finished"===e.t0?63:"screen_share_stopped"===e.t0?65:"browser_screen_share_supported"===e.t0?67:"leavedFromRoom"===e.t0?69:"closed"===e.t0?78:"play_finished"===e.t0?80:"streamInformation"===e.t0?83:"roomInformation"===e.t0?85:"data_channel_opened"===e.t0?96:"data_channel_closed"===e.t0?101:"data_received"===e.t0?105:"refreshConnection"===e.t0?107:"whiteBoardData"===e.t0?109:"handRaise"===e.t0?113:"screensharing"===e.t0?121:"stop_screensharing"===e.t0?128:"micChange"===e.t0?133:"syncUser"===e.t0?136:"closePeer"===e.t0?143:"recording_start"===e.t0?151:"recording_stop"===e.t0?154:"ledger"===e.t0?157:159;break;case 5:for(console.log("chatHistory",a),d=function(e){var t,i;if("message"===(null===(t=a[e])||void 0===t?void 0:t.replyType)){var s,o,r,c='\n            <div class="left_chat">\n                    <div class="left_chat_left">\n                    <div >\n                    <p class="user_icon2">'.concat(a[e].from[0],'</p>\n                   </div> \n                      <div class="chat_content">\n                        <p>').concat(a[e].from,"</p>\n                        <span>").concat(window.webRTCAdaptor.decryptMessage(a[e].message),'</span>\n                      </div>\n                    </div>\n                    <div class="chat_right" id="reply').concat(a[e].umessageId,'">\n                    <img class="reply_btn" src="https://img.icons8.com/ios-glyphs/30/ffffff/reply-arrow.png"/>\n                    </div>\n                    <span class="time_stamp_chat2">').concat(null===(s=a[e])||void 0===s?void 0:s.timeStamp,"</span>\n                  </div>\n            ");if(_()("#messageBox").append(c),document.getElementById("reply".concat(a[e].umessageId)).addEventListener("click",(function(t){n.chatHandlerReply(a[e])})),(null===(o=a[e])||void 0===o||null===(r=o.reply)||void 0===r?void 0:r.length)>0)for(var d=0;d<(null===(l=a[e])||void 0===l||null===(m=l.reply)||void 0===m?void 0:m.length);d++){var l,m,v,f,g,b,w,y,k,S='\n                    <div class="left_chat">\n                        <div class="left_chat_left">\n                          <div>\n                            <p class="user_icon">'.concat(null===(v=a[e])||void 0===v||null===(f=v.reply[d])||void 0===f?void 0:f.from[0],'</p>\n                          </div> \n                        <div class="reply_file_content">\n                            <p>').concat(null===(g=a[e])||void 0===g||null===(b=g.reply[d])||void 0===b?void 0:b.from,"</p>\n                            <span>").concat(window.webRTCAdaptor.decryptMessage(null===(w=a[e])||void 0===w||null===(y=w.reply[d])||void 0===y?void 0:y.message),'</span>\n                        <div class="chat_content2">\n                          <p class="reply2name">').concat(a[e].from,'</p>\n                          <span class="reply2mes">').concat(window.webRTCAdaptor.decryptMessage(a[e].message),'</span>\n                        </div>\n                        </div>\n                        </div>\n                    <span class="time_stamp_chat2">').concat(null===(k=a[e])||void 0===k?void 0:k.timeStamp,"</span>\n\n                    </div>\n                           ");_()("#messageBox").append(S)}}else if("endcall"===(null===(i=a[e])||void 0===i?void 0:i.replyType)){var j=(u=a[e].endDate).split(/[/:\-T]/),x=Object(h.a)(j,5),C=x[0],O=x[1],T=x[2],I=(x[3],x[4],new Date(a[e].endDate)),N=new Date,A=Math.round(Math.abs((I-N)/864e5));console.log(A),p=1===A?"Yesterday":0===A?"Today":"".concat(O," / ").concat(T," / ").concat(C);var M=a[e].duration.split(":"),R=M[0],E=M[1],D=Math.round(M[2]),P=new Date(u).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),V='\n            <div class="call_details">\n            <p class="call_details_p"> \n            <img src="https://img.icons8.com/external-those-icons-fill-those-icons/25/ffffff/external-call-mobile-telephone-those-icons-fill-those-icons.png" style="opacity=0.8"/>\n             '.concat(p,",&ensp;").concat(P,'</p>\n            <p class="call_details_p"> call ended, &ensp;').concat(R,"h ").concat(E,"m ").concat(D,"s</p>\n            </div>");_()("#messageBox").append(V)}else{var B,L,U,F='\n            <div class="left_chat">\n                <div class="left_chat_left">\n                  <div  class="user_icon_block">\n                    <p class="user_icon2">'.concat(a[e].from[0],'</p>\n                  </div> \n                  <div class="file_content">\n                    <p>').concat(a[e].from,'</p>\n                    <div class="chat_content2">\n                     <div class="href_a">').concat(a[e].file,'</div>\n                     <a  class="down_ref" href=').concat(a[e].name,' target="_blank" download>Download</a>\n                    </div>\n                  </div>\n                </div>\n                  <div class="chat_right" id="reply').concat(a[e].umessageId,'">\n                    <img class="reply_btn" src="https://img.icons8.com/ios-glyphs/30/ffffff/reply-arrow.png"/>\n                  </div>\n                    <span class="time_stamp_chat2">').concat(null===(B=a[e])||void 0===B?void 0:B.timeStamp,"</span>\n            </div>\n            ");if(_()("#messageBox").append(F),document.getElementById("reply".concat(a[e].umessageId)).addEventListener("click",(function(t){n.fileHandlerReply(a[e])})),(null===(L=a[e])||void 0===L||null===(U=L.reply)||void 0===U?void 0:U.length)>0)for(var H=0;H<(null===(J=a[e])||void 0===J||null===(W=J.reply)||void 0===W?void 0:W.length);H++){var J,W,G,z,q,Y,X,Z,$,Q='\n              <div class="left_chat">\n                <div class="left_chat_left">\n                    <div  class="user_icon_block">\n                        <p class="user_icon2">'.concat(null===(G=a[e])||void 0===G||null===(z=G.reply[H])||void 0===z?void 0:z.from[0],'</p>\n                      </div> \n                      <div class="reply_file_content">\n                      <p>').concat(null===(q=a[e])||void 0===q||null===(Y=q.reply[H])||void 0===Y?void 0:Y.from,'</p>\n                      <span class="replyFileName">').concat(window.webRTCAdaptor.decryptMessage(null===(X=a[e])||void 0===X||null===(Z=X.reply[H])||void 0===Z?void 0:Z.message),'</span>\n                      <div class="chat_content2">\n                      <p class="reply2name">').concat(a[e].from,'</p>\n                      <div class="href_a">').concat(a[e].file,'</div>\n                      <a  class="down_ref" href=').concat(a[e].name,' target="_blank" download>Download</a>\n                      </div>\n                      </div>\n              </div>\n                    <span class="time_stamp_chat2">').concat(null===($=a[e])||void 0===$?void 0:$.timeStamp,"</span>\n                    </div>\n              ");_()("#messageBox").append(Q)}}},l=0;l<(null===a||void 0===a?void 0:a.length);l++)d(l);return e.abrupt("break",160);case 9:return n.setState({message:a.message}),a.umessageId===n.state.leftChat?(g='\n                <div class="right_chat">\n                  <div class="left_chat_left">\n                    <div>\n                     <div  class="user_icon">'.concat(a.from[0],'</div>\n                    </div>          \n                    <div class="chat_content">\n                      <p>').concat(a.from,"</p>\n                      <span>").concat(window.webRTCAdaptor.decryptMessage(a.message),'</span>\n                    </div>\n                  </div>\n                     <div class="chat_right">\n                     </div>\n                    <span class="time_stamp_chat2">').concat(null===a||void 0===a?void 0:a.timeStamp,"</span>\n                </div>\n          "),_()("#messageBox").append(g),null===(f=n.scrollDiv.current)||void 0===f||f.scrollIntoView({behavior:"smooth",block:"nearest"}),n.setState({leftChat:"",seenStatus:!1})):(n.state.setDouble?n.setState({actualMessage:0}):n.setState({actualMessage:n.state.actualMessage+1}),y='\n        <div class="left_chat" id='.concat(a.umessageId,'>\n                <div class="left_chat_left">\n                <div >\n                <p class="user_icon2">').concat(a.from[0],'</p>\n               </div> \n                  <div class="chat_content">\n                    <p>').concat(a.from,"</p>\n                    <span>").concat(window.webRTCAdaptor.decryptMessage(a.message),'</span>\n                  </div>\n                </div>\n                <div class="chat_right" id="reply').concat(a.umessageId,'">\n                     <img class="reply_btn" src="https://img.icons8.com/ios-glyphs/30/ffffff/reply-arrow.png"/>\n               \n                     </div>\n                    <span class="time_stamp_chat2">').concat(null===a||void 0===a?void 0:a.timeStamp,"</span>\n              </div>\n        "),_()("#messageBox").append(y),document.getElementById("reply".concat(a.umessageId)).addEventListener("click",(function(e){n.chatHandlerReply(a)})),null===(b=n.scrollDiv)||void 0===b||null===(w=b.current)||void 0===w||w.scrollIntoView({behavior:"smooth",block:"nearest"}),n.setState({leftChat:"",seenStatus:!0,messageSent:!1,newMessage:!0})),e.abrupt("break",160);case 12:return console.log(a),n.setState({message:"Sent a file"}),a.umessageId===n.state.leftChat?(S='\n          <div class="right_chat">\n                  <div class="left_chat_left">\n                  <div >\n                  <p class="user_icon">'.concat(a.from[0],'</p>\n                 </div> \n                  <div class="file_content">\n                    <p>').concat(a.from,'</p>\n                  <div class="chat_content2">\n                  <div class="href_a">').concat(a.file,'</div>\n                  <a  class="down_ref" href=').concat(a.name,' target="_blank" download>Download</a>\n                  </div>\n                  </div>\n                  </div>              \n                    <span class="time_stamp_chat2">').concat(null===a||void 0===a?void 0:a.timeStamp,"</span>\n                </div>\n          "),_()("#messageBox").append(S),null===(k=n.scrollDiv.current)||void 0===k||k.scrollIntoView({behavior:"smooth",block:"nearest"}),n.setState({leftChat:"",messageSent:!1,seenStatus:!1})):(n.state.setDouble?n.setState({actualMessage:0}):n.setState({actualMessage:n.state.actualMessage+1}),n.setState({leftChat:"",seenStatus:!0,messageSent:!1,newMessage:!0}),x='\n          <div class="left_chat">\n                  <div class="left_chat_left">\n                  <div  class="user_icon_block">\n                  <p class="user_icon2">'.concat(a.from[0],'</p>\n                 </div> \n                  <div class="file_content">\n                  <p>').concat(a.from,'</p>\n                  <div class="chat_content2">\n                  <div class="href_a">').concat(a.file,'</div>\n                  <a  class="down_ref" href=').concat(a.name,' target="_blank" download>Download</a>\n                  </div>\n                  </div>\n                  </div>\n                  <div class="chat_right" id="reply').concat(a.umessageId,'">\n                  <img class="reply_btn" src="https://img.icons8.com/ios-glyphs/30/ffffff/reply-arrow.png"/>\n                    <span class="time_stamp_chat2">').concat(null===a||void 0===a?void 0:a.timeStamp,"</span>        \n                  </div>\n                </div>\n          "),_()("#messageBox").append(x),document.getElementById("reply".concat(a.umessageId)).addEventListener("click",(function(e){n.fileHandlerReply(a)})),null===(j=n.scrollDiv.current)||void 0===j||j.scrollIntoView({behavior:"smooth",block:"nearest"})),e.abrupt("break",160);case 16:return console.log(a),n.setState({message:"reply message"}),a[1].umessageId===n.state.leftChat?(T='\n          <div class="right_chat">\n                  <div class="left_chat_left">\n                  <div>\n                  <p class="user_icon">'.concat(a[1].from[0],'</p>\n                 </div> \n                  <div class="reply_file_content">\n                    <p>').concat(a[1].from,"</p>\n                    <span>").concat(window.webRTCAdaptor.decryptMessage(a[1].message),'</span>\n                  <div class="chat_content2">\n                  <p class="reply2name">').concat(a[0].from,'</p>\n                  <span class="reply2mes">').concat(window.webRTCAdaptor.decryptMessage(a[0].message),'</span>\n                  </div>\n                  </div>\n                  </div>\n                    <span class="time_stamp_chat2">').concat(null===(C=a[1])||void 0===C?void 0:C.timeStamp,"</span>\n                </div>\n          "),_()("#messageBox").append(T),null===(O=n.scrollDiv.current)||void 0===O||O.scrollIntoView({behavior:"smooth",block:"nearest"}),n.setState({leftChat:"",messageSent:!1,seenStatus:!1})):(n.state.setDouble?n.setState({actualMessage:0}):n.setState({actualMessage:n.state.actualMessage+1}),n.setState({leftChat:"",seenStatus:!0,messageSent:!1,newMessage:!0}),A='\n          <div class="left_chat">\n                  <div class="left_chat_left">\n                  <div>\n                  <p class="user_icon">'.concat(a[1].from[0],'</p>\n                 </div> \n                  <div class="reply_file_content">\n                    <p>').concat(a[1].from,"</p>\n                    <span >").concat(window.webRTCAdaptor.decryptMessage(a[1].message),'</p>\n                  <div class="chat_content2">\n                  <p class="reply2name">').concat(a[0].from,'</p>\n                  <span class="reply2mes">').concat(window.webRTCAdaptor.decryptMessage(a[0].message),'</span>\n                  </div>\n                  </div>\n                  </div>\n                    <span class="time_stamp_chat2">').concat(null===(I=a[1])||void 0===I?void 0:I.timeStamp,"</span>\n\n                </div>\n          "),_()("#messageBox").append(A),null===(N=n.scrollDiv.current)||void 0===N||N.scrollIntoView({behavior:"smooth",block:"nearest"})),e.abrupt("break",160);case 20:return console.log(a),n.setState({message:"reply message"}),a[1].umessageId===n.state.leftChat?(D='\n          <div class="right_chat">\n          <div class="left_chat_left">\n          <div  class="user_icon_block">\n          <p class="user_icon2">'.concat(a[1].from[0],'</p>\n         </div> \n          <div class="reply_file_content">\n          <p>').concat(a[1].from,'</p>\n          <span class="replyFileName">').concat(window.webRTCAdaptor.decryptMessage(a[1].message),'</span>\n          <div class="chat_content2">\n          <p class="reply2name">').concat(a[0].from,'</p>\n          <div class="href_a">').concat(a[0].file,'</div>\n          <a  class="down_ref" href=').concat(a[0].name,' target="_blank" download>Download</a>\n          </div>\n          </div>\n          </div>\n                    <span class="time_stamp_chat2">').concat(null===(M=a[1])||void 0===M?void 0:M.timeStamp,"</span>   \n                </div>\n          "),_()("#messageBox").append(D),null===(R=n.scrollDiv.current)||void 0===R||R.scrollIntoView({behavior:"smooth",block:"nearest"}),n.setState({leftChat:"",messageSent:!1,seenStatus:!1})):(n.state.setDouble?n.setState({actualMessage:0}):n.setState({actualMessage:n.state.actualMessage+1}),n.setState({leftChat:"",seenStatus:!0,messageSent:!1,newMessage:!0}),B='\n          <div class="left_chat">\n             <div class="left_chat_left">\n               <div  class="user_icon_block">\n               <p class="user_icon2">'.concat(a[1].from[0],'</p>\n               </div> \n               <div class="reply_file_content">\n               <p>').concat(a[1].from,'</p>\n               <span class="replyFileName">').concat(window.webRTCAdaptor.decryptMessage(a[1].message),'</span>\n               <div class="chat_content2">\n               <p class="reply2name"> ').concat(a[0].from,'</p>\n               <div class="href_a">').concat(a[0].file,'</div>\n               <a  class="down_ref" href=').concat(a[0].name,' target="_blank" download>Download</a>\n               </div>\n               </div>\n               </div>\n                    <span class="time_stamp_chat2">').concat(null===(P=a[1])||void 0===P?void 0:P.timeStamp,"</span>\n          </div>\n          "),_()("#messageBox").append(B),null===(V=n.scrollDiv.current)||void 0===V||V.scrollIntoView({behavior:"smooth",block:"nearest"})),e.abrupt("break",160);case 24:return n.setState({messageSent:!0,justSend:!0}),L={username:n.state.UserName,text:n.state.message,id:a.id,dbName:window.webRTCAdaptor.secToken},window.webRTCAdaptor.s.emit("messageReceived",L),e.abrupt("break",160);case 28:return e.next=30,E.a.success({message:"Message from ".concat(a.username),duration:3,description:Object(ae.jsx)(ae.Fragment,{children:Z()(window.webRTCAdaptor.decryptMessage(a.text))}),placement:"bottomRight"});case 30:return n.state.seenStatus&&n.state.newMessage&&n.state.setDouble&&window.webRTCAdaptor.s.emit("messageSeen"),e.abrupt("break",160);case 32:return n.setState({justSend:!1}),e.abrupt("break",160);case 34:return e.next=36,n.setState({TypingName:"".concat(a.userName),isTyping:!0});case 36:return e.abrupt("break",160);case 37:return e.next=39,n.setState({isTyping:!1,TypingName:""});case 39:case 40:case 41:return e.abrupt("break",160);case 42:return window.playOnly&&(window.isCameraOff=!0),window.webRTCAdaptor.isConnectionRefreshEnabled||window.webRTCAdaptor.autoJoin?(U=n.state.UserName,window.webRTCAdaptor.joinRoom(window.roomId,window.publishStreamId,U)):console.warn("The Connection Cannot be Refreshed!"),e.abrupt("break",160);case 45:return F=a.ATTR_ROOM_NAME,window.roomOfStream[a.streamId]=F,window.publishStreamId=a.streamId,H=n.state.UserName,window.playOnly?(window.isCameraOff=!0,window.webRTCAdaptor.play(window.roomId,window.token,window.token,a.streams)):Object(ee.publish)(window.webRTCAdaptor,a.streamId,window.token,H),null!=a.streams&&(a.streams.forEach((function(e){console.log("Stream joined with ID: "+e),window.webRTCAdaptor.play(e,window.token,window.roomId)})),window.streamsList=a.streams),window.roomTimerId=setInterval((function(){var e;null===(e=window.webRTCAdaptor)||void 0===e||e.getRoomInfo(window.roomId,window.publishStreamId)}),5e3),e.abrupt("break",160);case 53:return e.next=55,n.setState({MediaStreamList:r});case 55:return e.next=57,n.setState({MultiStream:c});case 57:return je(),n.forceUpdate(),e.abrupt("break",160);case 60:return console.debug("publish started to room: "+window.roomOfStream[a.streamId]),window.webRTCAdaptor.getRoomInfo(window.roomId,window.publishStreamId),e.abrupt("break",160);case 63:return console.debug("publish finished"),e.abrupt("break",160);case 65:return je(),e.abrupt("break",160);case 67:return console.log("browser screen share supported"),e.abrupt("break",160);case 69:return F=a.ATTR_ROOM_NAME,null!=window.roomTimerId&&clearInterval(window.roomTimerId),e.next=73,n.setState({MediaStreamList:r});case 73:return e.next=75,n.setState({MultiStream:c});case 75:return je(),window.streamsList=[],e.abrupt("break",160);case 78:return"undefined"!=typeof a&&console.log("Connection Closed"),e.abrupt("break",160);case 80:return window.webRTCAdaptor.s.emit("leftedMeeting",{streamId:window.publishStreamId,dbName:window.webRTCAdaptor.secToken}),je(),e.abrupt("break",160);case 83:return Object(ee.streamInformation)(window.webRTCAdaptor,a),e.abrupt("break",160);case 85:if((J=a.streams).push("!"+window.publishStreamId),n.state.isPlaying){e.next=91;break}return window.webRTCAdaptor.play(window.roomId,window.token,window.roomId,J),e.next=91,n.setState({isPlaying:!0});case 91:W=Object(m.a)(window.streamsList);try{for(W.s();!(G=W.n()).done;)z=G.value,a.streams.includes(z)||je()}catch(v){W.e(v)}finally{W.f()}return window.streamsList=a.streams,je(),e.abrupt("break",160);case 96:window.isDataChannelOpen=!0,console.log("obj getted",a);try{a!==window.publishStreamId?(console.log("getting joining user name",(null===(q=window.webRTCAdaptor.MediaStreamList)||void 0===q||null===(Y=q[a])||void 0===Y?void 0:Y.userName)+" Joined.."),n.openNotification("".concat(null===(X=window.webRTCAdaptor.MediaStreamList)||void 0===X||null===($=X[a])||void 0===$?void 0:$.userName," Joined.."))):(console.log("getting joining user name","Joined.."),n.openNotification("Joined..."))}catch(ve){console.log(" Joining username not found")}return je(),e.abrupt("break",160);case 101:try{a!==window.publishStreamId?(console.log("getting leaving user name",(null===(Q=window.webRTCAdaptor.MediaStreamList)||void 0===Q||null===(K=Q[a])||void 0===K?void 0:K.userName)+" Leaving.."),n.openNotification("".concat(null===(te=window.webRTCAdaptor.MediaStreamList)||void 0===te||null===(ne=te[a])||void 0===ne?void 0:ne.userName," Leaving..."))):(console.log("getting leaving user name","Leaving.."),n.openNotification("Leaving..."))}catch(fe){console.log(" Leaving username not found")}return window.isDataChannelOpen=!1,je(),e.abrupt("break",160);case 105:return Object(ee.handleNotificationEvent)(a),e.abrupt("break",160);case 107:return Object(ee.reInit)(a),e.abrupt("break",160);case 109:return n.openNotification("".concat(a.userName," opened whiteboard...")),ie="https://saveme.ai/whiteboard/".concat(n.state.ConsultationId),window.open(ie,"Save-Me DashBoard"),e.abrupt("break",160);case 113:return console.log("handRaise",a),se="raiseHand"+a.streamId,oe=document.getElementById(se),re="Hand"+a.streamId,ce="Thumbsup"+a.streamId,de="Heart"+a.streamId,"handraise"===a.partEmoji?(le='<h5 id="raiseHand'+a.streamId+'"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="yellow" class="bi bi-hand-index-fill" viewBox="0 0 16 16"><path d="M8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.632 2.632 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002z" /></svg>&nbsp;&nbsp;'+a.userName+"</h5>",oe?(_()(oe).remove(),a.streamId!==window.publishStreamId?(document.getElementById(re)&&(document.getElementById(re).style.display="none"),document.getElementById("HandscreenDiv")&&window.webRTCAdaptor.screenShareStream===a.streamId&&(document.getElementById("HandscreenDiv").style.display="none")):document.getElementById("Hand")&&(document.getElementById("Hand").style.display="none")):(_()("#raiseHand").append(le),a.streamId!==window.publishStreamId?(document.getElementById(re)&&(document.getElementById(re).style.display="block"),document.getElementById("HandscreenDiv")&&window.webRTCAdaptor.screenShareStream===a.streamId&&(document.getElementById("HandscreenDiv").style.display="block")):document.getElementById("Hand")&&(document.getElementById("Hand").style.display="block"))):"thumbsup"===a.partEmoji?a.streamId!==window.publishStreamId?(Object(ee.getHandRaiseEmojiTag)("Thumbsup",ce),document.getElementById("ThumbsupscreenDiv")&&window.webRTCAdaptor.screenShareStream===a.streamId&&Object(ee.getHandRaiseEmojiTag)("Thumbsup","ThumbsupscreenDiv")):document.getElementById("ThumbsupId")&&(document.getElementById("ThumbsupId").style.display="block",setTimeout((function(){document.getElementById("ThumbsupId").style.display="none"}),4e3)):a.streamId!==window.publishStreamId?(Object(ee.getHandRaiseEmojiTag)("Heart",de),document.getElementById("HeartscreenDiv")&&window.webRTCAdaptor.screenShareStream===a.streamId&&Object(ee.getHandRaiseEmojiTag)("Heart","HeartscreenDiv")):document.getElementById("HeartId")&&(document.getElementById("HeartId").style.display="block",setTimeout((function(){document.getElementById("HeartId").style.display="none"}),4e3)),e.abrupt("break",160);case 121:return window.webRTCAdaptor.screenShareStream=a.streamId,(null===(o=window.webRTCAdaptor)||void 0===o?void 0:o.isScreenShare)&&a.streamId!==window.publishStreamId&&(window.webRTCAdaptor.s.emit("stop_screensharing",{streamId:window.publishStreamId,dbName:window.webRTCAdaptor.secToken}),window.webRTCAdaptor.stopScreenShare(window.publishStreamId)),console.log("objjjjjjjjj1111",a),a.streamId!==window.publishStreamId&&(console.log("screenshare_started"),document.getElementById("screenshare").srcObject=document.getElementById("remoteVideo"+a.streamId).srcObject,document.getElementById("player"+a.streamId).style.display="none",document.getElementById("screensharediv").style.display="block"),n.forceUpdate(),je(),e.abrupt("break",160);case 128:return console.log("objjjjjjjjj",a),a.streamId!==window.publishStreamId&&(document.getElementById("player"+a.streamId).style.display="block",document.getElementById("screensharediv").style.display="none"),n.forceUpdate(),je(),e.abrupt("break",160);case 133:return console.log("micchange",a),a.streamId!==window.publishStreamId&&(console.log("if micchange"),Object(ee.handleNotificationEvent)(a),console.log("obj in mic chage",a),window.webRTCAdaptor.micDetails[a.streamId]="MIC_UNMUTED"===a.eventType),e.abrupt("break",160);case 136:return console.log("sync user case called",a.streamId),window.userList?(console.log("syncUser if"),"undefined"==typeof window.userList[a.streamId]&&(window.userList[a.streamId]=a,null!==document.getElementById("userName"+a.streamId)&&(document.getElementById("userName"+a.streamId).innerHTML=a.userName))):(console.log("syncUser else"),window.userList={},window.userList[a.streamId]=a,console.log("syncUser else userList",window.userList),null!==document.getElementById("userName"+a.streamId)&&(document.getElementById("userName"+a.streamId).innerHTML=a.userName)),ue=Object(ee.handleNotificationEvent)({eventType:"PARTICIPANT",streamId:window.userList}),me=Object(h.a)(ue,2),he=me[0],pe=me[1],window.participantList=he,window.participantCount=pe,console.log("participant",window.participantList,"count",window.participantCount),e.abrupt("break",160);case 143:return console.log(a),e.next=146,n.setState({MultiStream:c});case 146:return e.next=148,n.setState({MediaStreamList:r});case 148:return n.openNotification("".concat(a.data.userName," left")),je(),e.abrupt("break",160);case 151:return n.openNotification("".concat(a.userName," started recording...")),n.setState({isRecording:!0}),e.abrupt("break",160);case 154:return n.openNotification("".concat(a.userName," stoped recording...")),n.setState({isRecording:!1}),e.abrupt("break",160);case 157:return n.state.ledger=a.result,e.abrupt("break",160);case 159:return e.abrupt("break",160);case 160:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),n.defaultErrorCallback=function(){var e=Object(f.a)(v.a.mark((function e(t,a){var i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!=t.indexOf("publishTimeoutError")&&null!=window.roomTimerId&&(clearInterval(window.roomTimerId),window.location.reload()),i=JSON.stringify(t),"undefined"!=typeof a&&(i=a),-1==t.indexOf("NotFoundError")){e.next=9;break}return i="Camera or Mic are not found or not allowed in your device.",e.next=7,n.setState({isError:!0,displayMessage:i});case 7:e.next=44;break;case 9:if(-1===t.indexOf("NotReadableError")&&-1===t.indexOf("TrackStartError")){e.next=15;break}return i="Camera or Mic is being used by some other process that does not  allow these devices to be read.",e.next=13,n.setState({isError:!0,displayMessage:i});case 13:e.next=44;break;case 15:if(-1==t.indexOf("OverconstrainedError")&&-1==t.indexOf("ConstraintNotSatisfiedError")){e.next=21;break}return i="There is no device found that fits your video and audio constraints.",e.next=19,n.setState({isError:!0,displayMessage:i});case 19:e.next=44;break;case 21:if(-1==t.indexOf("NotAllowedError")&&-1==t.indexOf("PermissionDeniedError")){e.next=27;break}return i="You are not allowed to access camera and mic.",e.next=25,n.setState({isError:!0,displayMessage:i});case 25:e.next=44;break;case 27:if(-1==t.indexOf("TypeError")){e.next=32;break}i="Video/Audio is required.",console.log(i),e.next=44;break;case 32:if(-1==t.indexOf("UnsecureContext")){e.next=37;break}i="Browser cannot access camera and mic because of unsecure context. Please install SSL and access via https",n.openNotification(i),e.next=44;break;case 37:if(-1==t.indexOf("WebSocketNotSupported")){e.next=43;break}return i="WebSocket not supported in this browser",e.next=41,n.setState({isError:!0,displayMessage:i});case 41:e.next=44;break;case 43:-1!=t.indexOf("no_stream_exist")||(-1!=t.indexOf("data_channel_error")?(i="There was a error during data channel communication",n.openNotification(i)):-1!=t.indexOf("ScreenSharePermissionDenied")?(i="You are not allowed to access screen share",n.openNotification(i)):-1!=t.indexOf("WebSocketNotConnected")?n.setState({webSocketModel:!0,displayMessage:"Your call is disconnected Please refresh",isError:!0}):n.openNotification(i));case 44:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),n.componentDidMount=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getvaluesfromurl();case 2:return e.next=4,n.openJoinModal();case 4:console.log("initialised cmdidmount",n.props),window.addEventListener("load",(function(e){je(),window.onresize=je}),!1);case 6:case"end":return e.stop()}}),e)}))),n.getvaluesfromurl=Object(f.a)(v.a.mark((function e(){var t,a,i,s,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(null===(t=n.props)||void 0===t||null===(a=t.location)||void 0===a?void 0:a.search),o=M.a.parse(null===(i=n.props)||void 0===i||null===(s=i.location)||void 0===s?void 0:s.search),console.log(o,"DDDDDDDDDDDDDDDD"),e.next=5,n.setState({ConsultationId:o.ConsultationId});case 5:if(!(null===o||void 0===o?void 0:o.UserName)){e.next=8;break}return e.next=8,n.setState({UserName:o.UserName});case 8:if(!(null===o||void 0===o?void 0:o.UserRole)){e.next=11;break}return e.next=11,n.setState({USERROLE:o.UserRole});case 11:if(!o.Automate||o.Automate!==u.d){e.next=14;break}return e.next=14,n.setState({isAutomate:!0});case 14:window.roomId=o.ConsultationId;case 15:case"end":return e.stop()}}),e)}))),n.initiateWebRtc=function(){window.webRTCAdaptor=new ee.WebRTCAdaptor({mediaConstraints:{video:n.state.isCameraOn,audio:n.state.isMicOn},autoJoin:!0,localVideoId:"#localVideo",roomName:n.state.ConsultationId,ioPath:"https://saveme.ai/",secToken:u.f,callback:n.customCallback,callbackError:n.defaultErrorCallback})},n.backgroundChange=function(){window.webRTCAdaptor.backgroundChangeCl()},n.removeBackground=function(){window.webRTCAdaptor.removeBackground()},n.checkCameraPerMission=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){return e.getTracks().forEach((function(e){return e.stop()})),!0})).catch((function(e){return!1}));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),n.getlocalVideo=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.mediaDevices.getUserMedia({audio:n.state.isMicOn,video:n.state.isCameraOn}).then((function(e){console.log("stream",e),n.setState({LocalStream:e}),(t=document.querySelector("#modelLocalVideo")).srcObject=e,console.log("video element source",t.srcObject),t.play()})).catch((function(e){return console.log(e,"media device error")}));case 1:case"end":return e.stop()}}),e)}))),n.stopLocalStream=function(){var e;(null===(e=n.state.LocalStream)||void 0===e?void 0:e.getTracks())&&n.state.LocalStream.getTracks().forEach((function(e){e.stop()}))},n.getPerViewLocalVideo=function(){var e;navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(t){console.log("stream",t),n.setState({LocalStream:t}),(e=document.querySelector("#PerViewLocalVideo")).srcObject=t,console.log("video element source",e.srcObject),e.play()}))},n.muteMic=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.webRTCAdaptor.muteLocalMic(window.publishStreamId);case 2:if(t=e.sent,console.log(t,"micof"),!t){e.next=7;break}return e.next=7,n.setState({isMicOn:!1});case 7:case"end":return e.stop()}}),e)}))),n.unMuteMic=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.webRTCAdaptor.unmuteLocalMic(window.publishStreamId);case 2:t=e.sent,console.log(t,"micon"),t&&n.setState({isMicOn:!0});case 5:case"end":return e.stop()}}),e)}))),n.turnOfCamera=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.webRTCAdaptor.turnOffLocalCamera();case 2:t=e.sent,console.log(t,"cof"),t&&n.setState({isCameraOn:!1});case 5:case"end":return e.stop()}}),e)}))),n.turnOnCamera=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.webRTCAdaptor.turnOnLocalCamera();case 2:t=e.sent,console.log(t,"con"),t&&n.setState({isCameraOn:!0});case 5:case"end":return e.stop()}}),e)}))),n.enableRecording=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.webRTCAdaptor.enableRecording(window.publishStreamId,n.state.UserName);case 2:t=e.sent,console.log(t,"ron"),t&&n.setState({isRecording:!0});case 5:case"end":return e.stop()}}),e)}))),n.disableRecording=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("dis"),e.next=3,window.webRTCAdaptor.disableRecording();case 3:t=e.sent,console.log(t,"rof"),t&&n.setState({isRecording:!1});case 6:case"end":return e.stop()}}),e)}))),n.startScreenShare=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.webRTCAdaptor.startScreenShare(window.publishStreamId);case 2:t=e.sent,console.log(t,"sson");case 4:case"end":return e.stop()}}),e)}))),n.stopScreenShare=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.webRTCAdaptor.stopScreenShare(window.publishStreamId);case 2:t=e.sent,console.log(t,"ssoff");case 4:case"end":return e.stop()}}),e)}))),n.endCall=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(null===(t=window.webRTCAdaptor)||void 0===t?void 0:t.isScreenShare)&&n.stopScreenShare(),e.next=3,window.webRTCAdaptor.stop(window.publishStreamId);case 3:0===window.streamsList.length&&(console.log("endcall checking"),window.webRTCAdaptor.s.emit("endcall",{streamId:window.publishStreamId,dbName:window.webRTCAdaptor.secToken})),setTimeout((function(){n.props.history.push({pathname:"".concat(u.a,"/VideoCallEnd")})}),3e3);case 5:case"end":return e.stop()}}),e)}))),n.openJoinModal=Object(f.a)(v.a.mark((function e(){var t,a,i,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,!n.state.isAutomate){e.next=5;break}t=!0,e.next=8;break;case 5:return e.next=7,n.checkCameraPerMission();case 7:t=e.sent;case 8:if(!t){e.next=28;break}return e.next=11,n.setState({isError:!1});case 11:return e.next=13,n.setState({isJoinModal:!0});case 13:return e.next=15,n.getlocalVideo();case 15:return e.next=17,pe("USERNAME");case 17:if(a=e.sent,i=n.state.UserName,!a&&!i){e.next=26;break}return e.next=22,pe("USERROLE");case 22:s=e.sent,console.log(s,n.state.USERROLE,"UserROle"),s&&n.setState({USERROLE:s}),n.formApiJoin.setValue("UserName",a||i);case 26:e.next=30;break;case 28:return e.next=30,n.setState({isError:!0,displayMessage:"Your Camera is Blocked"});case 30:case"end":return e.stop()}}),e)}))),n.closeJoinModal=function(){n.setState({isJoinModal:!1}),n.stopLocalStream()},n.handleJoinOk=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.formApiJoin.getValue("UserName"),window.UserName=t,e.next=4,n.setState({UserName:t});case 4:return e.next=6,n.initiateWebRtc();case 6:return e.next=8,n.closeJoinModal();case 8:case"end":return e.stop()}}),e)}))),n.handleJoinCancel=function(){n.stopLocalStream(),console.log("cancel"),n.closeJoinModal(),n.props.history.push({pathname:"".concat(u.a,"/VideoCallEnd")})},n.onEnableCamera=function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return e.next=3,n.setState({isCameraOn:!0});case 3:return e.next=5,n.getlocalVideo();case 5:e.next=13;break;case 7:return e.next=9,n.setState({isCameraOn:!1});case 9:return e.next=11,n.getlocalVideo();case 11:return e.next=13,n.stopLocalStream();case 13:console.log(t,"camera");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.openInvitation=Object(f.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_()("<input>"),a=_()(window.location).attr("href"),_()("body").append(t),t.val(a).select(),document.execCommand("copy"),t.remove(),e.next=8,n.setState({inviteUrl:a,isInviteModal:!0,DoctorData:[],SelectedDoctor:""});case 8:case"end":return e.stop()}}),e)}))),n.setFormApiSms=function(e){n.formApiSms=e},n.setFormApiJoin=function(e){n.formApiJoin=e},n.customValidationSms=function(e){if(e){var t=new RegExp(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/),a=new RegExp(/^(\+91|0)?\d{10}$/);return t.test(e)||a.test(e)?void 0:"Enter Valid Data"}return"Enter Valid Data"},n.ValidateUserName=function(e){if(!(e&&e.trim().length>0))return"Enter User Name"},n.sendInviteMsg=Object(f.a)(v.a.mark((function e(){var t,a,i,s,o,r,c,d,l,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.formApiSms.getValue("UserData"),a=new RegExp(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/),i=new RegExp(/^(\+91|0)?\d{10}$/),s="Message Not Send",n.setState({isInviteModal:!1}),!a.test(t)){e.next=15;break}return o=t,r="Hi, this is video call request from ".concat("saveme.ai",", please join by clicking the below link ",n.state.inviteUrl," -- PREMATIX"),"Saveme.ai Video Call Invitation",e.next=11,fe(r,o,"Saveme.ai Video Call Invitation");case 11:(c=e.sent).data.response&&(s=c.data.response),e.next=27;break;case 15:if(!i.test(t)){e.next=25;break}return d=t,l=n.state.inviteUrl,e.next=20,ve(d,l);case 20:u=e.sent,console.log(u,"resss"),1==u.data.statusCode&&u.data.response.includes("Success")&&(s="Message Send Successfully"),e.next=27;break;case 25:console.log("wrong data"),s="Message Not Send";case 27:n.openNotification(s);case 28:case"end":return e.stop()}}),e)}))),n.openSetting=function(){n.setState({isOpenSetting:!0})},n.onAfterChangeMicGain=function(e){var t=window.webRTCAdaptor.changeVolume(e);console.log(e,t,"mic gain")},n.onVideoQualityChange=function(e){console.log(e,"video quality",e.value),window.webRTCAdaptor.changeBandwidth(e.value,window.publishStreamId)},n.debounce=function(e,t){var a=null;return function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];clearTimeout(a),a=setTimeout((function(){e.apply(void 0,i)}),t)}},n.handleDoctorNameChange=n.debounce(function(){var e=Object(f.a)(v.a.mark((function e(t){var a,i,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setState({isFetching:!0}),console.log(t,"search"),!t){e.next=9;break}return e.next=5,ge(t);case 5:1===(s=e.sent).data.statusCode&&(null===(a=s.data)||void 0===a||null===(i=a.response)||void 0===i?void 0:i.length)>0?n.setState({DoctorData:s.data.response}):n.setState({DoctorData:[]}),e.next=10;break;case 9:n.setState({DoctorData:[]});case 10:n.setState({isFetching:!1});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),n.handleDoctorChange=function(e){console.log(e,"selected"),n.setState({SelectedDoctor:e})},n.onSelectDoctorData=function(e){console.log(e.target.value,"data for doctor"),n.formApiSms.setValue("UserData",e.target.value)},n.toggleChat=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(document.getElementById("participant_toggle").style.display="none",!n.state.isOpenChat){e.next=9;break}return document.getElementById("chat_toggle").style.display="none",e.next=7,n.setState({setDouble:!1,newMessage:!1,isOpenChat:!1,isOpenParticipant:!1});case 7:e.next=15;break;case 9:return document.getElementById("chat_toggle").style.display="block",e.next=13,n.setState({setDouble:!0,actualMessage:0,isOpenChat:!0,isOpenParticipant:!1});case 13:null===(t=n.scrollDiv.current)||void 0===t||t.scrollIntoView({behavior:"smooth",block:"nearest"}),n.state.newMessage&&window.webRTCAdaptor.s.emit("messageSeen");case 15:je();case 16:case"end":return e.stop()}}),e)}))),n.toggleParticipant=Object(f.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("chat_toggle"),a=document.getElementById("participant_toggle"),t.style.display="none",!n.state.isOpenParticipant){e.next=9;break}return a.style.display="none",e.next=7,n.setState({isOpenChat:!1,isOpenParticipant:!1});case 7:e.next=12;break;case 9:return a.style.display="block",e.next=12,n.setState({isOpenChat:!1,isOpenParticipant:!0,setDouble:!1});case 12:je();case 13:case"end":return e.stop()}}),e)}))),n.onEmojiClick=function(){var e=Object(f.a)(v.a.mark((function e(t,a){var i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({selectedEmoji:a,visibleEmoji:!1});case 2:console.log(n.state.selectedEmoji),i=document.getElementById("text").textContent,document.getElementById("text").textContent=void 0===i?String.fromCodePoint(parseInt(a.unified,16)):i+String.fromCodePoint(parseInt(a.unified,16));case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),n.submitData=function(e){var t=document.getElementById("text").textContent;13===e.keyCode?(e.preventDefault(),n.sendMesg()):n.setState({showUserDropList:!1}),50===e.keyCode&&1===t.trim().length?n.setState({showUserDropList:!0}):n.setState({showUserDropList:!1})},n.sendMesg=n.debounce(Object(f.a)(v.a.mark((function e(){var t,a,i,s,o,r,c,d,l,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object($.a)(),console.log(t),n.setState({leftChat:t}),a=new Date,i=a.getHours()+":"+a.getMinutes(),s=document.getElementById("text").innerHTML,0!==document.getElementById("text").textContent.trim().length){e.next=26;break}if(!n.state.fileAppend){e.next=22;break}if(!0!==n.state.youCanSend){e.next=17;break}return n.setState({fileAppend:!1,targetFileName:"",targetFile:""}),o={from:n.state.UserName,name:n.state.FileTobeSend.data.image,file:n.state.FileTobeSend.data.filename,umessageId:t,time:new Date,dbName:window.webRTCAdaptor.secToken,timeStamp:i,reply:[],replyType:"file"},e.next=14,window.webRTCAdaptor.s.emit("File",o);case 14:_()("#fileUploader").val(""),e.next=20;break;case 17:return e.next=19,D.b.warning("Please try again...");case 19:n.setState({targetFile:"",FileLoading:!1});case 20:e.next=24;break;case 22:return e.next=24,D.b.warning("Please send something...");case 24:e.next=39;break;case 26:if(n.state.youCanSendTo?(r={from:n.state.UserName,message:window.webRTCAdaptor.encryptMessage(s),userId:n.state.selectedMentionUserId,umessageId:t,timeStamp:i,time:new Date,dbName:window.webRTCAdaptor.secToken,reply:[],replyType:"message"},window.webRTCAdaptor.s.emit("privatemessage",r),n.setState({selectedUserDropList:!1,youCanSendTo:!1,selectedMentionUser:"",selectedMentionUserId:""})):n.state.replyMessageActivated||n.state.replyFileMessageActivated?(n.state.replyMessageActivated&&(d={from:n.state.UserName,timeStamp:i,message:window.webRTCAdaptor.encryptMessage(s),umessageId:t,time:new Date,dbName:window.webRTCAdaptor.secToken,reply:[],replyType:"message"},window.webRTCAdaptor.s.emit("replymessage",d,n.state.selectedReplyMessageId),n.setState({replyMessageActivated:!1})),n.state.replyFileMessageActivated&&(l={from:n.state.UserName,message:window.webRTCAdaptor.encryptMessage(s),timeStamp:i,umessageId:t,time:new Date,dbName:window.webRTCAdaptor.secToken,reply:[],replyType:"message"},console.log({replyData:l}),window.webRTCAdaptor.s.emit("replyfilemessage",l,n.state.selectedReplyMessageId),n.setState({replyFileMessageActivated:!1}))):(c={from:n.state.UserName,message:window.webRTCAdaptor.encryptMessage(s),timeStamp:i,umessageId:t,time:new Date,dbName:window.webRTCAdaptor.secToken,reply:[],replyType:"message"},window.webRTCAdaptor.s.emit("message",c)),!n.state.fileAppend){e.next=39;break}if(!0!==n.state.youCanSend){e.next=32;break}n.setState({fileAppend:!1,targetFileName:"",targetFile:""}),e.next=35;break;case 32:return e.next=34,D.b.warning("Please try again...");case 34:n.setState({targetFile:""});case 35:return u={from:n.state.UserName,name:n.state.FileTobeSend.data.image,timeStamp:i,file:n.state.FileTobeSend.data.filename,umessageId:t,time:new Date,dbName:window.webRTCAdaptor.secToken,reply:[],replyType:"file"},e.next=38,window.webRTCAdaptor.s.emit("File",u);case 38:_()("#fileUploader").val("");case 39:document.getElementById("text").innerText="";case 40:case"end":return e.stop()}}),e)}))),1e3),n.onBlurTyping=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.state.focus&&(n.setState({focus:!1}),window.webRTCAdaptor.s.emit("typingEnd"));case 1:case"end":return e.stop()}}),e)}))),n.onFocusTyping=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.state.focus||(n.setState({focus:!0}),t={userName:n.state.UserName,dbName:window.webRTCAdaptor.secToken},window.webRTCAdaptor.s.emit("typing",t));case 1:case"end":return e.stop()}}),e)}))),n.onFileChange=function(){var e=Object(f.a)(v.a.mark((function e(t){var a,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.target.files,t.target,"files"),!(t.target.files[0].size>1048576)){e.next=9;break}return e.next=5,D.b.warning("Please Choose file less than 1 MB");case 5:return e.next=7,n.setState({targetFileName:"",fileAppend:!1,FileUploadProgress:0});case 7:e.next=17;break;case 9:return n.setState({targetFile:t.target.files[0],FileUploadProgress:0}),e.next=12,n.setState({targetFileName:t.target.files[0].name,fileAppend:!0});case 12:_()("#fileUploader").val(""),(a=new FormData).append("file",t.target.files[0]),i={onUploadProgress:function(e){var t=Math.round(100*e.loaded/e.total);n.setState({FileUploadProgress:t})},headers:{Authorization:"".concat(u.f)}},Y.a.post("https://saveme.ai/antmedia/d2/api/upload",a,i).then((function(e){console.log(e),n.setState({youCanSend:e.data.status,FileTobeSend:e}),console.log(n.state.youCanSend,"success")})).catch((function(e){n.setState({youCanSend:!1,fileAppend:!1,targetFile:!1,targetFileName:""}),console.log(e),console.log(n.state.youCanSend,"error")}));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.closeAppendedFile=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({targetFileName:"",fileAppend:!1,FileUploadProgress:0});case 2:case"end":return e.stop()}}),e)}))),n.handleVisibleChange=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({visibleEmoji:!n.state.visibleEmoji});case 1:case"end":return e.stop()}}),e)}))),n.makeTextBold=n.debounce(Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.state.bold?(n.inputRef.current.focus(),document.getElementById("jBold").style.border="1px solid silver",document.execCommand("bold",null,!1)):(t=document.getElementById("jBold"),document.execCommand("bold",null,!1),t.style.border="none"),e.next=3,n.setState({bold:!n.state.bold});case 3:case"end":return e.stop()}}),e)}))),500),n.strikethrough=n.debounce(Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.state.strike?(document.getElementById("jStrike").style.border="none",document.execCommand("strikethrough",null,!1)):(n.inputRef.current.focus(),document.getElementById("jStrike").style.border="1px solid silver",document.execCommand("strikethrough",null,!1)),e.next=3,n.setState({strike:!n.state.strike});case 3:case"end":return e.stop()}}),e)}))),500),n.makeTextItalic=n.debounce(Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.state.italic?(document.getElementById("jItalic").style.border="none",document.execCommand("italic",null,!1)):(n.inputRef.current.focus(),document.getElementById("jItalic").style.border="1px solid silver",document.execCommand("italic",null,!1)),e.next=3,n.setState({italic:!n.state.italic});case 3:case"end":return e.stop()}}),e)}))),500),n.makeTextUnderline=n.debounce(Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.state.underlined?(document.getElementById("jUnderline").style.border="none",document.execCommand("underline",null,!1)):(n.inputRef.current.focus(),document.getElementById("jUnderline").style.border="1px solid silver",document.execCommand("underline",null,!1)),e.next=3,n.setState({underlined:!n.state.underlined});case 3:case"end":return e.stop()}}),e)}))),500),n.submitHandlerLink=Object(f.a)(v.a.mark((function e(){var t,a,i,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=document.createElement("a"),a=document.getElementById("chat-t2d").value,i=document.getElementById("chat-l2wp").value,s=document.createTextNode(a),t.appendChild(s),t.title=a,t.target="_blank",t.href=i,document.getElementById("text").appendChild(t),n.setState({showInsertModal:!1});case 11:case"end":return e.stop()}}),e)}))),n.cancelInsertModal=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({showInsertModal:!1});case 2:case"end":return e.stop()}}),e)}))),n.mentionThisUser=function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("userSelected",t),n.setState({showUserDropList:!1,selectedUserDropList:!0,selectedMentionUser:t.userName,selectedMentionUserId:t.socketId,youCanSendTo:!0}),n.inputRef.current.focus();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.chatHandlerReply=function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,n.setState({selectedReplyMessageId:t.umessageId,replyMessageData:t,replyMessageActivated:!0});case 3:n.inputRef.current.focus();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.fileHandlerReply=function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,n.setState({selectedReplyMessageId:t.umessageId,replyFileData:t,replyFileMessageActivated:!0});case 3:n.inputRef.current.focus();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.reloadWindowFunction=function(){window.location.reload()},n.state={isAutomate:!1,MultiStream:new MediaStream,MediaStreamList:{},LocalStream:null,ConsultationId:"",UserName:"",isJoinModal:!1,isOpenChat:!1,isOpenParticipant:!1,isCameraOn:!0,isMicOn:!0,isRecording:!1,inviteUrl:"",isInviteModal:!1,isOpenSetting:!1,DoctorData:[],SelectedDoctor:"",targetFile:"",targetFileName:"",MessageId:"",messageSent:!1,justSend:!1,showInsertModal:!1,isFileTobeAppend:!1,seenStatus:!1,selectedEmoji:"",FileTobeSend:"",fileAppend:!1,visibleEmoji:!1,isTyping:!1,TypingName:"",isSeen:!1,focus:!1,setDouble:!1,leftChat:"",newMessage:"",InputText:"",message:"",actualMessage:0,bold:!1,previousText:"",italic:!1,underlined:!1,strike:!1,FileLoading:!1,youCanSend:!1,FileUploadProgress:0,showUserDropList:!1,selectedMentionUser:"",selectedUserDropList:!1,youCanSendTo:!1,selectedMentionUserId:"",selectedReplyMessageId:"",replyMessageActivated:!1,replyMessageData:[],replyFileData:[],replyFileMessageActivated:!1,isError:!1,displayMessage:"",webSocketModel:!1},n.inputRef=i.a.createRef(),n.scrollDiv=i.a.createRef(),n.width=532,n.heigth=400,n}return Object(c.a)(a,[{key:"render",value:function(){var e,t,a,n=this;return Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsxs)("div",{className:"overallbody",children:[Object(ae.jsx)("div",{id:"raiseHand",style:{display:"none"}}),Object(ae.jsxs)("div",{className:"video-call-container",children:[Object(ae.jsxs)("div",{className:"video_func_div",children:[Object(ae.jsxs)("div",{className:"video-call-container-header",children:[this.state.isRecording&&Object(ae.jsx)("div",{className:"video-call-container-header-recording",children:Object(ae.jsx)(y.e,{className:"func_icon_tooltip",style:{color:"red"}})}),Object(ae.jsx)("div",{className:"video-app-heading",children:"SaveMe"})]}),Object(ae.jsxs)("div",{className:"video_func_elements",children:[Object(ae.jsxs)("div",{className:"video_funcs first-options-btn",onClick:this.toggleParticipant,children:[this.state.MediaStreamList&&Object(ae.jsx)("span",{className:"count_span",children:(null===(e=Object.keys(this.state.MediaStreamList))||void 0===e?void 0:e.length)+1}),Object(ae.jsx)(O.c,{className:"func_icon"})]}),Object(ae.jsxs)("div",{className:"video_funcs ",onClick:this.toggleChat,children:[this.state.actualMessage>=1&&!this.state.setDouble?Object(ae.jsx)("span",{className:"count_span",children:this.state.actualMessage}):"",Object(ae.jsx)(S.a,{className:"func_icon"})]}),Object(ae.jsx)(P.a,{placement:"bottomLeft",overlayClassName:"threedot_options",destroyTooltipOnHide:!0,trigger:"click",title:Object(ae.jsxs)("div",{className:"options_container",children:[Object(ae.jsxs)("div",{className:"handrise-icons ",children:[Object(ae.jsx)("div",{className:"handrise-subicon handraise",onClick:function(){var e;null===(e=window.webRTCAdaptor)||void 0===e||e.showRaiseHand(window.publishStreamId,"handraise","user")},children:Object(ae.jsx)(w.a,{style:{cursor:"pointer",fontSize:"26px",color:"#ffc800"}})}),Object(ae.jsx)("div",{className:"handrise-subicon heart",onClick:function(){var e;null===(e=window.webRTCAdaptor)||void 0===e||e.showRaiseHand(window.publishStreamId,"heart","user")},children:Object(ae.jsx)(w.b,{style:{cursor:"pointer",fontSize:"26px",color:"#ff0000"}})}),Object(ae.jsx)("div",{className:"handrise-subicon thumbsup",onClick:function(){var e;null===(e=window.webRTCAdaptor)||void 0===e||e.showRaiseHand(window.publishStreamId,"thumbsup","user")},children:Object(ae.jsx)(b.a,{className:"ml-2",style:{cursor:"pointer",fontSize:"26px",color:"#ffc800"}})})]}),Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.backgroundChange,children:[Object(ae.jsx)(O.b,{className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Change Background"})]}),Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.removeBackground,children:[Object(ae.jsx)(O.a,{className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Remove Background"})]}),this.state.isRecording?Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.disableRecording,children:[Object(ae.jsx)(y.e,{className:"func_icon_tooltip",style:{color:"red"}}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Stop Recording"})]}):Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.enableRecording,children:[Object(ae.jsx)(y.e,{className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Start Recording"})]}),Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.openInvitation,children:[Object(ae.jsx)(O.d,{className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Invite People"})]}),!0===(null===(t=window.webRTCAdaptor)||void 0===t?void 0:t.isScreenShare)&&Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.stopScreenShare,children:[Object(ae.jsx)(g.d,{size:"20px",className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Stop Screen Share"})]}),!1===(null===(a=window.webRTCAdaptor)||void 0===a?void 0:a.isScreenShare)&&Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.startScreenShare,children:[Object(ae.jsx)(g.c,{size:"20px",className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Start Screen Share"})]}),Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.openSetting,children:[Object(ae.jsx)(y.g,{className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"Settings"})]}),Object(ae.jsxs)("div",{className:"video_funcs_tooltip",onClick:this.navigateToDashboard,children:[Object(ae.jsx)(g.b,{className:"func_icon_tooltip"}),"\xa0",Object(ae.jsx)("span",{className:"tooltip_options",children:"WhiteBoard"})]})]}),children:Object(ae.jsx)("div",{className:"video_funcs ",children:Object(ae.jsx)(S.b,{className:"func_icon"})})}),this.state.isMicOn?Object(ae.jsx)("div",{className:"video_funcs",onClick:this.muteMic,children:Object(ae.jsx)(y.c,{className:"func_icon"})}):Object(ae.jsx)("div",{className:"video_funcs",onClick:this.unMuteMic,children:Object(ae.jsx)(y.d,{className:"func_icon"})}),this.state.isCameraOn?Object(ae.jsx)("div",{className:"video_funcs video_funcs_corner",onClick:this.turnOfCamera,children:Object(ae.jsx)(O.e,{className:"func_icon"})}):Object(ae.jsx)(P.a,{placement:"bottom",overlayClassName:"perview-local-video",trigger:"hover",mouseEnterDelay:2,mouseLeaveDelay:2,onVisibleChange:function(e){console.log(e),e?n.getPerViewLocalVideo():n.stopLocalStream()},title:Object(ae.jsxs)("div",{className:"perview-video-container",children:[Object(ae.jsxs)("div",{className:"perview-title",children:[Object(ae.jsx)("span",{className:"perview-title-main",children:"Private perview"}),"\xa0",Object(ae.jsx)("span",{className:"perview-title-sub",children:"(only you can see this)"})]}),Object(ae.jsx)("div",{className:"perview-video-player",children:Object(ae.jsx)("video",{id:"PerViewLocalVideo",type:"video/ogg",className:"PerViewlocalVideo",autoPlay:!0,muted:!0})})]}),children:Object(ae.jsx)("div",{className:"video_funcs video_funcs_corner",onClick:this.turnOnCamera,children:Object(ae.jsx)(O.f,{className:"func_icon"})})}),Object(ae.jsxs)("div",{className:"video_funcs2",onClick:this.endCall,children:[Object(ae.jsx)(g.a,{className:"func_icon2"}),Object(ae.jsx)("span",{className:"leave-btn",children:" Leave"})]})]})]}),Object(ae.jsxs)("div",{className:"video_consultation_main",children:[Object(ae.jsxs)("div",{className:"videoPlayers",onContextMenu:function(e){return e.preventDefault()},children:[Object(ae.jsx)(K.a,{bounds:"parent",children:Object(ae.jsx)("div",{className:"localVideoPlayer",children:Object(ae.jsxs)("div",{className:"local-video-content",children:[Object(ae.jsx)("video",{id:"localVideo",className:"localVideo",autoPlay:!0,width:this.width,height:this.heigth,type:"video/mp4",muted:!0}),Object(ae.jsx)("img",{id:"posterImgId",className:"localVideo",src:te,alt:"img",style:{display:"none",width:"100%",height:"100%"}}),Object(ae.jsx)("canvas",{id:"posterImageCanvas",className:"localVideo",style:{display:"none",width:"100%",height:"100%"}}),Object(ae.jsx)("canvas",{id:"localVideoCanvas",className:"personBackGround",width:this.width,height:this.heigth}),Object(ae.jsx)("div",{className:"background-replacement",children:Object(ae.jsx)("img",{id:"bacImg",style:{width:this.width,height:this.height,display:"none"},src:we,alt:"BackGround"})}),Object(ae.jsx)("canvas",{id:"canvasSecId",style:{display:"none"},width:this.width,height:this.heigth}),Object(ae.jsxs)("div",{className:"local-video-user-details",children:[Object(ae.jsx)("div",{className:"local-video-username",children:"You"}),Object(ae.jsx)("span",{id:"Hand",style:{display:"none"},className:"handrise-subicon-localvideo handraise",onClick:function(){return window.webRTCAdaptor.showRaiseHand(window.publishStreamId,"handraise","user")},children:Object(ae.jsx)(w.a,{style:{cursor:"pointer",color:"#ffc800"}})}),Object(ae.jsx)("span",{id:"HeartId",style:{display:"none"},className:"handrise-subicon-localvideo mr-2 ml-2 heart",children:Object(ae.jsx)(w.b,{style:{color:"#ff0000"}})}),Object(ae.jsx)("span",{id:"ThumbsupId",style:{display:"none"},className:"handrise-subicon-localvideo thumbsup",children:Object(ae.jsx)(b.a,{className:"ml-2",style:{color:"#ffc800"}})})]})]})})}),Object(ae.jsx)("div",{id:"screensharediv",className:"screen-share-video-player",style:{display:"none"},children:Object(ae.jsxs)("div",{className:"screenshare-video-content",children:[Object(ae.jsx)("video",{id:"screenshare",poster:ye,className:"screen-share-video-tag ",autoPlay:!0}),Object(ae.jsx)("div",{className:"screenshare-user-detail",children:Object(ae.jsx)("div",{id:"screanShareIconDiv",children:Object(ae.jsxs)("div",{className:"screenshare-user-icons",children:[Object(ae.jsx)("i",{className:"antsdk-remote-video-mic-icon antsdk-remote-video-mic-icon-unmute",id:"munmutescreenDiv",style:{display:"block"},children:Object(ae.jsx)(y.c,{})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-mic-icon antsdk-remote-video-mic-icon-mute",id:"mmutescreenDiv",style:{display:"none"},children:Object(ae.jsx)(y.d,{})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-handraise-icon antsdk-remote-video-handraise-icon-handraise",id:"HandscreenDiv",style:{display:"none"},children:Object(ae.jsx)(w.a,{style:{color:"#ffc800"}})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-handraise-icon antsdk-remote-video-handraise-icon-thumbsup",id:"ThumbsupscreenDiv",style:{display:"none"},children:Object(ae.jsx)(b.a,{className:"ml-2",style:{color:"#ffc800"}})}),Object(ae.jsx)("i",{className:"antsdk-remote-video-handraise-icon antsdk-remote-video-handraise-icon-heart",id:"HeartscreenDiv",style:{display:"none"},children:Object(ae.jsx)(w.b,{style:{color:"#ff0000"}})})]})})})]})}),Object(ae.jsx)("div",{id:"players",className:"antsdk-remote-video-players",children:this.state.MultiStream&&this.state.MultiStream.getVideoTracks().map((function(e){return Object(ae.jsx)(ne,{streamId:e.id,videoTrack:e,userName:e.id,raiseIfRequired:n.customCallback,ledger:n.state.ledger,notifyUser:n.openNotification})}))})]}),Object(ae.jsx)("div",{className:"side_div_main",id:"participant_toggle",children:Object(ae.jsx)(ie,{MediaStreamList:this.state.MediaStreamList,onToogleParticipant:this.toggleParticipant})}),Object(ae.jsx)("div",{className:"side_div_main",id:"chat_toggle",children:Object(ae.jsxs)("div",{className:"chat_div",children:[Object(ae.jsxs)("div",{className:"chatHeader",children:[Object(ae.jsx)("div",{className:"chat-close",onClick:function(){return n.toggleChat()},children:Object(ae.jsx)(b.b,{})}),Object(ae.jsx)("span",{className:"Qoute",children:"Chat"}),this.state.isTyping?Object(ae.jsxs)("p",{className:"typingindic",children:[Object(ae.jsxs)("span",{className:"chat-typer-name",children:[" ",this.state.TypingName]}),"\xa0typing",Object(ae.jsx)("div",{style:{marginLeft:"5px",fontSize:"18px"},children:Object(ae.jsx)(ke,{})})]}):""]}),Object(ae.jsxs)("div",{className:"chat_body",children:[Object(ae.jsx)("div",{id:"messageBox"}),this.state.messageSent&&Object(ae.jsx)("div",{className:"messageSeen",children:this.state.justSend?Object(ae.jsx)("p",{title:"sent",children:Object(ae.jsx)(w.c,{className:"seen_icon"})}):Object(ae.jsx)("p",{title:"seen",children:Object(ae.jsx)(j.a,{className:"seen_icon"})})}),Object(ae.jsx)("div",{id:"emptyDiv",className:"p-2",ref:this.scrollDiv,children:"    "})]}),Object(ae.jsxs)("div",{className:"text_input",children:[Object(ae.jsxs)(W.a,{className:"input_send",children:[Object(ae.jsx)(G.a,{id:"file_viewer",children:this.state.fileAppend&&Object(ae.jsxs)("div",{className:"file_append",style:{flexDirection:"column"},children:[Object(ae.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[Object(ae.jsxs)("div",{classsName:"file_append_body",children:[Object(ae.jsx)("div",{className:"file_icon_div",children:Object(ae.jsx)(y.b,{className:"file_icon"})}),Object(ae.jsx)("p",{className:"file_append_file",children:this.state.targetFileName})," "]}),Object(ae.jsx)("div",{className:"file_icon_close",children:Object(ae.jsx)(y.a,{className:"close_file_icon",onClick:this.closeAppendedFile})})]}),this.state.FileUploadProgress>1?Object(ae.jsx)(V.a,{strokeColor:{"0%":"rgb(180, 224, 215)","100%":"#209f85"},percent:this.state.FileUploadProgress}):""]})}),Object(ae.jsxs)(G.a,{style:{display:"flex",paddingRight:"0px",paddingLeft:"0px"},children:[this.state.showUserDropList&&Object(ae.jsx)("div",{className:"user_mention",children:this.state.MediaStreamList&&Object.values(this.state.MediaStreamList).map((function(e){return Object(ae.jsx)("p",{className:"user_mention_list",onClick:function(){n.mentionThisUser(e)},children:e.userName})}))}),this.state.replyMessageActivated&&Object(ae.jsxs)("div",{className:"reply_content_sel reply_chat_sel",children:[Object(ae.jsxs)("div",{class:"reply_chat_content",children:[Object(ae.jsx)("p",{children:this.state.replyMessageData.from}),Object(ae.jsx)("span",{children:Z()(window.webRTCAdaptor.decryptMessage(this.state.replyMessageData.message))})]}),Object(ae.jsx)("div",{className:"file_icon_close",children:Object(ae.jsx)(y.a,{className:"close_file_icon",onClick:function(){n.setState({replyMessageActivated:!1,selectedReplyMessageId:""})}})})]}),this.state.replyFileMessageActivated&&Object(ae.jsxs)("div",{className:"reply_content_sel reply_file_sel",children:[Object(ae.jsxs)("div",{class:"reply_chat_content",children:[Object(ae.jsx)("p",{children:this.state.replyFileData.from}),Object(ae.jsx)("span",{children:this.state.replyFileData.file})]}),Object(ae.jsx)("div",{className:"file_icon_close",children:Object(ae.jsx)(y.a,{className:"close_file_icon",onClick:function(){n.setState({replyFileMessageActivated:!1,selectedReplyMessageId:""})}})})]}),this.state.selectedUserDropList&&Object(ae.jsxs)("div",{className:"user_mention_sel",children:[Object(ae.jsxs)("p",{className:"mentioned_user",children:["Send(privately) ",Object(ae.jsx)("br",{}),' to : "',this.state.selectedMentionUser,'"']}),Object(ae.jsx)("div",{className:"file_icon_close",children:Object(ae.jsx)(y.a,{className:"close_file_icon",onClick:function(){n.setState({selectedUserDropList:!1,youCanSendTo:!1})}})})]}),Object(ae.jsx)("div",{id:"text",contentEditable:"true",style:{width:"80% !important",padding:"25px !important",paddingLeft:"17px",borderRadius:"25px !important"},className:"text_input_box",onKeyDown:function(e){n.submitData(e)},onFocus:this.onFocusTyping,onBlur:this.onBlurTyping,ref:this.inputRef,spellCheck:"true"}),Object(ae.jsx)("div",{className:"chat_header_close2",onClick:this.sendMesg,children:Object(ae.jsx)(y.f,{className:"sendbtn"})})]})]}),Object(ae.jsxs)("div",{className:"file_editor",children:[Object(ae.jsx)("div",{children:Object(ae.jsx)(C.a,{className:"attach_pin",style:{cursor:"pointer"}})})," ",Object(ae.jsx)(ue,{type:"file",id:"fileUploader",field:"prescriptionLink",onChange:function(e){n.onFileChange(e)}}),Object(ae.jsx)(B.a,{visible:this.state.visibleEmoji,trigger:"click",onVisibleChange:function(e){return n.setState({visibleEmoji:e})},content:Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsx)("div",{className:"emoji_div",children:Object(ae.jsx)(I.a,{onEmojiClick:this.onEmojiClick})})}),title:"Emoji Picker",children:Object(ae.jsx)("button",{id:"insertLink",className:"bold_text",onClick:function(){return n.setState({visibleEmoji:!n.state.visibleEmoji})},children:Object(ae.jsx)(x.a,{className:"emoji_picker_chat"})})}),Object(ae.jsx)("button",{id:"jBold",className:"bold_text",onClick:this.makeTextBold,children:Object(ae.jsx)(S.c,{})}),Object(ae.jsx)("button",{id:"jUnderline",className:"bold_text",onClick:this.makeTextUnderline,children:Object(ae.jsx)(k.c,{})}),Object(ae.jsx)("button",{id:"jItalic",className:"bold_text",onClick:this.makeTextItalic,children:Object(ae.jsx)(k.a,{})}),Object(ae.jsx)("button",{id:"jStrike",className:"bold_text",onClick:this.strikethrough,children:Object(ae.jsx)(k.b,{})})]})]})]})})]})]}),Object(ae.jsxs)(ae.Fragment,{children:[this.state.isJoinModal&&Object(ae.jsx)(L.a,{style:{top:30},title:"Save Me",width:"800px",visible:this.state.isJoinModal,onCancel:this.handleJoinCancel,footer:null,destroyOnClose:!0,className:"joinmodel_container",children:Object(ae.jsxs)(W.a,{className:"joinModel",children:[Object(ae.jsx)(G.a,{md:6,className:"modelLocalVideoPlayer",onContextMenu:function(e){return e.preventDefault()},children:Object(ae.jsx)("video",{id:"modelLocalVideo",type:"video/ogg",className:"modellocalVideo",autoPlay:!0,muted:!0})}),Object(ae.jsx)(G.a,{md:6,className:"joining-localVideoControls",children:Object(ae.jsx)(J.a,{getApi:this.setFormApiJoin,onSubmit:this.handleJoinOk,children:function(e){e.formApi;var t,a=e.formState;return Object(ae.jsx)("div",{className:"joining-form",children:Object(ae.jsxs)(W.a,{children:[Object(ae.jsxs)(G.a,{md:12,className:"mt-3",children:[Object(ae.jsx)(U.a,{onChange:n.onEnableCamera,defaultChecked:!0,className:"switch_modal"})," \xa0",Object(ae.jsx)("label",{className:"join-label ",children:"Enable Camera "})]}),Object(ae.jsxs)(G.a,{md:8,className:"mt-3 pb-4",children:[Object(ae.jsx)("label",{className:"join-label mb-1",children:"User Name"}),Object(ae.jsx)(J.d,{placeholder:"Enter User Name",field:"UserName",className:"form-control joining-username ".concat((null===a||void 0===a||null===(t=a.errors)||void 0===t?void 0:t.UserName)?"noUserName":""),validate:function(e){return n.ValidateUserName(e)},valid:!0,validateOnBlur:!0,validateOnChange:!0})]}),Object(ae.jsxs)(G.a,{md:10,className:"d-flex",children:[Object(ae.jsx)("button",{type:"submit",className:"joinbtn btn btn-primary ",children:"Join"}),Object(ae.jsx)("button",{className:"btn cancelbtn  btn-outline-primary ml-4",onClick:function(){return n.handleJoinCancel()},children:"Cancel"})]})]})})}})})]})}),this.state.isError&&Object(ae.jsx)(L.a,{title:"Save Me",visible:this.state.isError,footer:null,closable:!1,destroyOnClose:!0,children:Object(ae.jsxs)("div",{className:"CameraAccessModel",children:[Object(ae.jsx)("div",{className:"camera-access-block",children:this.state.displayMessage}),this.state.webSocketModel&&Object(ae.jsx)(z.a,{className:"btn btn-primary",onClick:function(){return n.reloadWindowFunction()},children:" Refresh"})]})}),this.state.isInviteModal&&Object(ae.jsx)(L.a,{title:"Save Me",visible:this.state.isInviteModal,onCancel:function(){n.setState({isInviteModal:!1})},footer:null,destroyOnClose:!0,children:Object(ae.jsx)("div",{className:"InviteModel",children:Object(ae.jsx)(J.a,{getApi:this.setFormApiSms,onSubmit:this.sendInviteMsg,children:function(e){var t,a,i,s;e.formApi,e.formState;return Object(ae.jsxs)(W.a,{children:["D"===n.state.USERROLE&&Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsxs)(G.a,{md:12,children:[Object(ae.jsx)("h6",{className:"invitation_label",children:"Search Doctor Name"}),Object(ae.jsx)(R.a,{showSearch:!0,value:n.state.SelectedDoctor,placeholder:"Search a Doctor",style:{width:"100%"},defaultActiveFirstOption:!1,showArrow:!0,filterOption:!1,onSearch:n.handleDoctorNameChange,onChange:n.handleDoctorChange,notFoundContent:n.state.isFetching?Object(ae.jsx)(F.a,{size:"small"}):"No Data",children:n.state.DoctorData.map((function(e){return Object(ae.jsx)(xe,{value:JSON.stringify(e),children:e.DoctorName+","+e.SpecialityTypeName+","+e.HospitalName},e.DoctorId)}))})]}),n.state.SelectedDoctor&&Object(ae.jsx)(G.a,{className:"mt-3 ml-3",children:Object(ae.jsxs)(J.c,{field:"SelectedDoctorData",onChange:n.onSelectDoctorData,children:[Object(ae.jsx)(W.a,{children:Object(ae.jsxs)("h6",{className:"invitation_label",children:[Object(ae.jsx)(J.b,{value:"".concat(null===(t=JSON.parse(n.state.SelectedDoctor))||void 0===t?void 0:t.MobileNo),className:"invite_radio"}),"\xa0Mobile No :",null===(a=JSON.parse(n.state.SelectedDoctor))||void 0===a?void 0:a.MobileNo]})}),Object(ae.jsx)(W.a,{children:Object(ae.jsxs)("h6",{className:"invitation_label",children:[Object(ae.jsx)(J.b,{className:"invite_radio",value:"".concat(null===(i=JSON.parse(n.state.SelectedDoctor))||void 0===i?void 0:i.MailId)}),"\xa0Email Id :",null===(s=JSON.parse(n.state.SelectedDoctor))||void 0===s?void 0:s.MailId]})})]})})]}),Object(ae.jsxs)(G.a,{md:12,className:"mt-3",children:[Object(ae.jsx)("h6",{className:"invitation_label",children:"Mobile No / Email Id"}),Object(ae.jsx)(J.d,{className:"form-control invite-user",field:"UserData",validate:function(e){return n.customValidationSms(e)},validateOnBlur:!0})]}),Object(ae.jsxs)(G.a,{md:12,className:"mt-4",children:[Object(ae.jsx)("h6",{className:"invitation_label",children:"Invitation Link Copied"}),Object(ae.jsx)("div",{className:"invitation_label_link",children:n.state.inviteUrl})]}),Object(ae.jsx)(G.a,{md:12,style:{marginTop:"40px"},children:Object(ae.jsx)("button",{className:"invite-btn",type:"submit",children:"Send Invitation Link"})})]})}})})}),this.state.isOpenSetting&&Object(ae.jsx)(L.a,{title:"Settings",visible:this.state.isOpenSetting,onCancel:function(){n.setState({isOpenSetting:!1})},footer:null,children:Object(ae.jsxs)("div",{className:"video-settings",children:[Object(ae.jsx)("h6",{className:"setting_label",children:"Microphone volume:"}),Object(ae.jsx)(G.a,{span:6,children:Object(ae.jsx)(H.a,{min:0,max:1,defaultValue:1,onAfterChange:this.onAfterChangeMicGain,step:.01})}),Object(ae.jsx)("h6",{className:"setting_label",children:" Video quality:"}),Object(ae.jsx)(G.a,{span:6,children:Object(ae.jsxs)(R.a,{labelInValue:!0,defaultValue:{value:"".concat(window.webRTCAdaptor.bandwidth)||"50"},style:{width:140},onChange:this.onVideoQualityChange,children:[Object(ae.jsx)(xe,{value:"50",children:"Low(Default)"}),Object(ae.jsx)(xe,{value:"1200",children:"Average"}),Object(ae.jsx)(xe,{value:"1500",children:"High"}),Object(ae.jsx)(xe,{value:"4000",children:"HD 720"}),Object(ae.jsx)(xe,{value:"8000",children:"HD 1080"})]})})]})})]})]})})}}]),a}(i.a.Component),Oe=a(464),Te=a(71),Ie=a(708),Ne=a.p+"static/media/videohome.a23c251e.svg",_e=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).startVideo=function(){console.log(n.props),n.props.history.push({pathname:"".concat(u.a,"/VideoConsultation"),search:"?ConsultationId=61977707bbf6efd64e490b54",editState:{preProps:n.props}})},n.createRoom=Object(f.a)(v.a.mark((function e(){var t,a,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.state.roomName.trim()){e.next=7;break}return e.next=3,be(n.state.roomName);case 3:(null===(i=e.sent)||void 0===i||null===(t=i.data)||void 0===t?void 0:t.status)&&(null===i||void 0===i||null===(a=i.data)||void 0===a?void 0:a.roomId)?(D.b.success("Room created successfully"),n.props.history.push({pathname:"".concat(u.a,"/VideoConsultation"),search:"?ConsultationId=".concat(i.data.roomId)})):D.b.warning("Try again"),e.next=8;break;case 7:D.b.warning("Enter Room Name");case 8:case"end":return e.stop()}}),e)}))),n.state={roomName:""},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return Object(ae.jsxs)("div",{className:"row  justify-content-center w-100 mt-5",children:[Object(ae.jsx)("div",{className:"col-lg-7  col-md-7 col-sm-12 pl-5",children:Object(ae.jsx)("img",{src:Ne,width:"90%",alt:"video"})}),Object(ae.jsx)("div",{className:"col-lg-4  col-md-4 col-sm-8 d-flex align-item-center ",children:Object(ae.jsx)("div",{className:"d-flex  mt-auto mb-auto",children:Object(ae.jsxs)("div",{className:"row ml-auto  mr-auto p-4",children:[Object(ae.jsx)("button",{className:"col-12 btn btn-lg btn-primary mt-2",onClick:this.startVideo,children:"Join Test Room"}),Object(ae.jsx)(Ie.a,{style:{borderWidth:1,borderColor:"#393939"},children:"or"}),Object(ae.jsxs)("div",{className:" col-12  mt-3 pb-4",children:[Object(ae.jsx)("h6",{children:"New Room Name"}),Object(ae.jsx)(J.d,{placeholder:"Enter Room Name",onChange:function(t){e.setState({roomName:t.target.value})},className:"form-control ",field:"RoomName"})]}),Object(ae.jsx)("button",{className:" col-12 btn btn-lg btn-primary ",onClick:this.createRoom,children:"Create New Room"})]})})})]})}}]),a}(n.Component),Ae=a.p+"static/media/endcall.c2383a34.gif",Me=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return Object(ae.jsx)("div",{className:"end-call",children:Object(ae.jsxs)("div",{className:"d-flex  flex-column justify-content-center w-100 mt-5",children:[Object(ae.jsx)("div",{className:" d-flex  pt-4 justify-content-center ",children:Object(ae.jsx)("img",{src:Ae,width:"300px",alt:"Call Ended"})}),Object(ae.jsx)("div",{className:" pt-3  text-center",style:{fontSize:"24px",fontWeight:"600",color:"#f14c4c",fontFamily:"Poppins"},children:"Call Ended..."})]})})}}]),a}(n.Component),Re=function(e){Object(d.a)(a,e);var t=Object(l.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsx)(Oe.a,{children:Object(ae.jsxs)(Te.d,{children:[Object(ae.jsx)(Te.b,{path:"".concat(u.a,"/VideoConsultation"),component:Ce}),Object(ae.jsx)(Te.b,{path:"".concat(u.a,"/videoHome"),component:_e}),Object(ae.jsx)(Te.b,{path:"".concat(u.a,"/videoCallEnd"),component:Me}),Object(ae.jsx)(Te.a,{to:"".concat(u.a,"/videoHome")})]})})})}}]),a}(n.Component),Ee=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,716)).then((function(t){var a=t.getCLS,n=t.getFID,i=t.getFCP,s=t.getLCP,o=t.getTTFB;a(e),n(e),i(e),s(e),o(e)}))};o.a.render(Object(ae.jsx)(i.a.StrictMode,{children:Object(ae.jsx)(Re,{})}),document.getElementById("root")),Ee()},99:function(e,t,a){var n=a(565),i=a(3),s=a(251),o=a(252),r=a(568),c=a(569),d=a(570),l=a(571),u=a(700).default,m=a(699),h=a(371),p=a(572),v=a(590);function f(){return(f=r(i.mark((function e(t){var a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.roomOfStream[t.streamId],null!=(a=document.querySelector("#remoteVideo"+t.streamId))){e.next=6;break}return e.next=5,createRemoteVideo(t.streamId);case 5:a=document.querySelector("#remoteVideo"+t.streamId);case 6:a.srcObject=t.stream;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}window.roomOfStream=new Array,window.streamsList=new Array,window.playOnly=!1,Array.prototype.inArray=function(e){for(var t=0;t<this.length;t++)if(e(this[t]))return!0;return!1},Array.prototype.pushIfNotExist=function(e,t){this.inArray(t)||this.push(e)};var g=function(){"use strict";function e(t){var a=this;for(var n in s(this,e),this.peerconnection_config={iceServers:[{urls:["stun:stun.prematix.tech:3478","stun:stun1.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun.l.google.com:19302"]},{username:"prematix",credential:"Pr3m@t1x_123",urls:["turn:turn.prematix.tech:3478"]}],sdpSemantics:"unified-plan"},this.websocket_url="wss://saveme.ai/ws",this.mediaConstraints={video:!0,audio:!0},this.sdp_constraints={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},this.screenShareStream=null,this.icon=null,this.localVideoId="localVideo",this.autoJoin=!1,this.isConnectionRefreshEnabled=!1,this.isScreenShare=!1,this.isScreenShareAndCamera=!1,this.remotePeerConnection=new Array,this.remotePeerConnectionStats=new Array,this.remoteDescriptionSet=new Array,this.iceCandidateList=new Array,this.roomName=null,this.videoTrackSender=null,this.audioTrackSender=null,this.playStreamId=new Array,this.isMicOn=!1,this.isCameraOn=!1,this.currentVolume=null,this.multiStream=new MediaStream,this.dummyCanvas=document.createElement("canvas"),this.originalAudioTrackGainNode=null,this.videoTrack=null,this.audioTrack=null,this.smallVideoTrack=null,this.audioContext=null,this.MediaStreamList=new Array,this.soundOriginGainNode=null,this.secondStreamGainNode=null,this.localStream=null,this.bandwidth=50,this.isMultiPeer=!1,this.multiPeerStreamId=null,this.isWebSocketTriggered=!1,this.webSocketAdaptor=null,this.isPlayMode=!1,this.debug=!1,this.viewerInfo="",this.onlyDataChannel=!1,this.recorder=null,this.isRecordingEnabled=!1,this.xindex=0,this.yindex=0,this.micMute=!1,this.localStreamId=null,this.userName=null,this.micDetails={},this.participantsList=[],this.userList=[],this.speakerHighlighter=!1,this.backgroundChangeVar=!1,this.handRaise=!1,this.blackFrameTimer=null,this.socketId=null,this.idMapping=new Array,this.tempStream=null,this.publishMode="camera",this.candidateTypes=["udp","tcp"],this.desktopStream=null,this.camera_location="top",this.camera_margin=15,this.camera_percent=15,t)t.hasOwnProperty(n)&&(this[n]=t[n]);if(this.localVideo=document.querySelector(this.localVideoId),this.remoteVideo=document.querySelector(this.remoteVideoId),"camera"==this.mediaConstraints.video?this.publishMode="camera":"screen"==this.mediaConstraints.video?this.publishMode="screen":"screen+camera"==this.mediaConstraints.video&&(this.publishMode="screen+camera"),this.checkBrowserScreenShareSupported(),this.isPlayMode||this.onlyDataChannel||"undefined"==typeof this.mediaConstraints||null!=this.localStream)this.checkWebSocketConnection();else if(this.checkWebRTCPermissions(),this.getDevices(),this.trackDeviceChange(),"undefined"!=typeof this.mediaConstraints.video&&0!=this.mediaConstraints.video)this.openStream(this.mediaConstraints,this.mode),this.isMicOn=this.mediaConstraints.audio,this.isCameraOn=this.mediaConstraints.video;else{this.isMicOn=this.mediaConstraints.audio;var i={audio:this.mediaConstraints.audio};this.navigatorUserMedia(i,(function(e){a.gotStream(e)}),!0)}this.ioPath?(this.s=m.connect(this.ioPath),this.s.emit("join-room",{roomId:this.roomName,dbName:this.secToken}),this.s.onAny((function(e,t){"ledger"==e&&(a.socketId=t.socketId),a.callback(e,t)}))):this.callbackError("error connecting io adaptor"),this.backgroundModel()}return o(e,[{key:"setDesktopwithCameraSource",value:function(e,t,a,n){var i=this;this.desktopStream=e,this.navigatorUserMedia({video:!0,audio:!1},(function(a){i.smallVideoTrack=a.getVideoTracks()[0];var s=document.createElement("canvas"),o=s.getContext("2d"),r=document.createElement("video");r.srcObject=e,r.play();var c=document.createElement("video");c.srcObject=a,c.play();var d=s.captureStream(15);null==i.localStream?i.gotStream(d):i.updateVideoTrack(d,t,i.mediaConstraints,onended,null),null!=n&&(e.getVideoTracks()[0].onended=function(e){n(e)}),setInterval((function(){s.width=r.videoWidth,s.height=r.videoHeight,o.drawImage(r,0,0,s.width,s.height);var e,t=r.videoWidth*(i.camera_percent/100),a=c.videoHeight/c.videoWidth*t,n=s.width-t-i.camera_margin;e="top"==i.camera_location?i.camera_margin:s.height-a-i.camera_margin,o.drawImage(c,n,e,t,a)}),66)}),!0)}},{key:"trackDeviceChange",value:function(){var e=this;navigator.mediaDevices.ondevicechange=function(){e.getDevices()}}},{key:"getDevices",value:function(){var e=this;navigator.mediaDevices.enumerateDevices().then((function(t){var a=new Array,n=!1;t.forEach((function(e){"audioinput"!=e.kind&&"videoinput"!=e.kind||(a.push(e),"audioinput"==e.kind&&(n=!0))})),e.callback("available_devices",a),0==n&&null==e.localStream&&(console.log("Audio input not found"),console.log("Retrying to get user media without audio"),e.openStream({video:!0,audio:!1},e.mode))})).catch((function(e){console.error("Cannot get devices -> error name: "+e.name+": "+e.message)}))}},{key:"prepareStreamTracks",value:function(e,t,a,n){var i=this,s=a.getAudioTracks();if(s.length>0&&"camera"==this.publishMode&&(s[0].stop(),a.removeTrack(s[0])),"undefined"!=t&&0!=t){var o={audio:t};this.navigatorUserMedia(o,(function(o){o=i.setGainNodeStream(o),null!==i.originalAudioTrackGainNode&&i.originalAudioTrackGainNode.stop(),i.originalAudioTrackGainNode=o.getAudioTracks()[1];var r=function(t){i.callback("screen_share_stopped"),i.setVideoCameraSource(n,e,null,!0)};if("screen"==i.publishMode)if(i.updateVideoTrack(a,n,e,r,!0),s.length>0){var c=i.mixAudioStreams(a,o,n);i.updateAudioTrack(c,n,null)}else i.updateAudioTrack(o,n,null);else if("screen+camera"==i.publishMode)if(s.length>0){c=i.mixAudioStreams(a,o,n);i.updateAudioTrack(c,n,null),i.setDesktopwithCameraSource(a,n,c,r)}else i.updateAudioTrack(o,n,null),i.setDesktopwithCameraSource(a,n,o,r);else 0!=t&&void 0!=t&&a.addTrack(o.getAudioTracks()[0]),i.gotStream(a);i.checkWebSocketConnection()}),!0)}else"undefined"!=typeof audioStream&&null!=audioStream.getAudioTracks()[0]&&a.addTrack(audioStream.getAudioTracks()[0]),this.gotStream(a)}},{key:"navigatorUserMedia",value:function(e,t,a){var n=this;1==a?navigator.mediaDevices.getUserMedia(e).then(t).catch((function(e){"NotFoundError"==e.name?n.getDevices():n.callbackError(e.name,e.message)})):navigator.mediaDevices.getUserMedia(e).then(t)}},{key:"getUserMedia",value:function(e,t,a){var n=this,i=function(e){var t=e.getVideoTracks(),a=e.getAudioTracks();return t.length>0&&(null!==n.videoTrack&&n.videoTrack.stop(),n.videoTrack=t[0]),a.length>0&&(null!==n.audioTrack&&n.audioTrack.stop(),n.audioTrack=a[0]),n.smallVideoTrack&&n.smallVideoTrack.stop(),e};"screen+camera"==this.publishMode||"screen"==this.publishMode?navigator.mediaDevices.getDisplayMedia(e).then((function(s){i(s),n.prepareStreamTracks(e,t,s,a)})).catch((function(e){if("NotAllowedError"===e.name)if(console.debug("Permission denied error"),n.callbackError("ScreenSharePermissionDenied"),null==n.localStream){n.openStream({video:!0,audio:!0})}else n.switchVideoCameraCapture(a)})):this.navigatorUserMedia(e,(function(s){i(s),n.prepareStreamTracks(e,t,s,a)}),!0)}},{key:"openStream",value:function(e){this.mediaConstraints=e;var t=!1;"undefined"!=typeof e.audio&&0!=e.audio&&(t=e.audio),"undefined"!=typeof e.video?this.getUserMedia(e,t):(console.error("MediaConstraint video is not defined"),this.callbackError("media_constraint_video_not_defined"))}},{key:"closeStream",value:function(){this.localStream.getVideoTracks().forEach((function(e){e.onended=null,e.stop()})),this.localStream.getAudioTracks().forEach((function(e){e.onended=null,e.stop()})),null!==this.videoTrack&&this.videoTrack.stop(),null!==this.audioTrack&&this.audioTrack.stop(),null!==this.smallVideoTrack&&this.smallVideoTrack.stop(),this.originalAudioTrackGainNode&&this.originalAudioTrackGainNode.stop()}},{key:"checkWebRTCPermissions",value:function(){return"WebSocket"in window?"undefined"==typeof navigator.mediaDevices&&0==this.isPlayMode?(console.log("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void this.callbackError("UnsecureContext")):void("undefined"!=typeof navigator.mediaDevices&&void 0!=navigator.mediaDevices&&null!=navigator.mediaDevices||this.callbackError("getUserMediaIsNotAllowed")):(console.log("WebSocket not supported."),void this.callbackError("WebSocketNotSupported"))}},{key:"checkBrowserScreenShareSupported",value:function(){("undefined"!=typeof navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia)&&this.callback("browser_screen_share_supported")}},{key:"enableSecondStreamInMixedAudio",value:function(e){null!=this.secondStreamGainNode&&(this.secondStreamGainNode.gain.value=e?1:0)}},{key:"publish",value:function(e,t,a,n,i,s){var o=this;if(this.publishStreamId=e,this.onlyDataChannel)var r={command:"publish",streamId:e,streamName:JSON.stringify({username:i,socketId:this.socketId}),token:t,subscriberId:void 0!==typeof a?a:"",subscriberCode:void 0!==typeof n?n:"",mainTrack:void 0!==typeof s?s:"",video:!1,audio:!1};else if(null==this.localStream)this.navigatorUserMedia(this.mediaConstraints,(function(r){o.gotStream(r);var c={command:"publish",streamId:e,streamName:JSON.stringify({username:i,socketId:o.socketId}),token:t,subscriberId:void 0!==typeof a?a:"",subscriberCode:void 0!==typeof n?n:"",mainTrack:void 0!==typeof s?s:"",video:o.localStream.getVideoTracks().length>0,audio:o.localStream.getAudioTracks().length>0};o.webSocketAdaptor.send(JSON.stringify(c))}),!1);else{r={command:"publish",streamId:e,streamName:JSON.stringify({username:i,socketId:this.socketId}),token:t,subscriberId:void 0!==typeof a?a:"",subscriberCode:void 0!==typeof n?n:"",mainTrack:void 0!==typeof s?s:"",video:this.localStream.getVideoTracks().length>0,audio:this.localStream.getAudioTracks().length>0};console.log("jscmd3",r)}this.webSocketAdaptor.send(JSON.stringify(r))}},{key:"joinRoom",value:function(e,t,a){this.roomName=e;var n={command:"joinRoom",room:e,streamId:t,mode:"multitrack"};this.webSocketAdaptor.send(JSON.stringify(n))}},{key:"play",value:function(e,t,a,n,i,s){if(e==this.roomName||e==this.publishStreamId){this.playStreamId.push(e);var o={command:"play",streamId:e,token:t,room:a,trackList:n,subscriberId:void 0!==typeof i?i:"",subscriberCode:void 0!==typeof s?s:"",viewerInfo:this.viewerInfo};this.webSocketAdaptor.send(JSON.stringify(o))}else console.warn("Mode:MultiTrack, Unwanted Peer Connections are Ommitted")}},{key:"stop",value:function(e){this.closePeerConnection(e);var t={command:"stop",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))}},{key:"join",value:function(e){var t={command:"join",streamId:e,multiPeer:this.isMultiPeer&&null==this.multiPeerStreamId,mode:this.isPlayMode?"play":"both"};this.webSocketAdaptor.send(JSON.stringify(t))}},{key:"leaveFromRoom",value:function(e){this.roomName=e;var t={command:"leaveFromRoom",room:e};console.log("leave request is sent for "+e),this.webSocketAdaptor.send(JSON.stringify(t))}},{key:"leave",value:function(e){var t={command:"leave",streamId:this.isMultiPeer&&null!=this.multiPeerStreamId?this.multiPeerStreamId:e};this.webSocketAdaptor.send(JSON.stringify(t)),this.closePeerConnection(e),this.multiPeerStreamId=null}},{key:"getStreamInfo",value:function(e){var t={command:"getStreamInfo",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))}},{key:"getRoomInfo",value:function(e,t){var a={command:"getRoomInfo",streamId:t,room:e};this.webSocketAdaptor.send(JSON.stringify(a))}},{key:"enableTrack",value:function(e,t,a){var n={command:"enableTrack",streamId:e,trackId:t,enabled:a};this.webSocketAdaptor.send(JSON.stringify(n))}},{key:"getTracks",value:function(e,t){this.playStreamId.push(e);var a={command:"getTrackList",streamId:e,token:t};this.webSocketAdaptor.send(JSON.stringify(a))}},{key:"gotStream",value:function(e){e=this.setGainNodeStream(e),this.localStream=e,this.localVideo.srcObject=e,this.checkWebSocketConnection(),this.getDevices()}},{key:"toggleVideo",value:function(e,t,a){var n={command:"toggleVideo",streamId:e,trackId:t,enabled:a};this.webSocketAdaptor.send(JSON.stringify(n))}},{key:"toggleAudio",value:function(e,t,a){var n={command:"toggleAudio",streamId:e,trackId:t,enabled:a};this.webSocketAdaptor.send(JSON.stringify(n))}},{key:"switchDesktopCapture",value:function(){var e=r(i.mark((function e(t){var a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.backgroundChangeVar){e.next=4;break}return e.next=3,this.removeBackground();case 3:this.backgroundChangeVar=!0;case 4:this.publishMode="screen",a=!1,"undefined"!=typeof this.mediaConstraints.audio&&0!=this.mediaConstraints.audio&&(a=this.mediaConstraints.audio),this.getUserMedia(this.mediaConstraints,a,t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"mixAudioStreams",value:function(e,t,a){var n=new MediaStream;e.getVideoTracks().forEach((function(e){n.addTrack(e)})),this.audioContext=new AudioContext;var i=this.audioContext.createMediaStreamDestination();e.getAudioTracks().length>0?(this.soundOriginGainNode=this.audioContext.createGain(),this.soundOriginGainNode.gain.value=1,this.audioContext.createMediaStreamSource(e).connect(this.soundOriginGainNode).connect(i)):console.debug("Origin stream does not have audio track");t.getAudioTracks().length>0?(this.secondStreamGainNode=this.audioContext.createGain(),this.secondStreamGainNode.gain.value=1,this.audioContext.createMediaStreamSource(t).connect(this.secondStreamGainNode).connect(i)):console.debug("Second stream does not have audio track");return i.stream.getAudioTracks().forEach((function(e){n.addTrack(e),console.log("audio destination add track")})),n}},{key:"setGainNodeStream",value:function(e){var t=e.getVideoTracks(),a=e.getAudioTracks();this.audioContext=new AudioContext;var i=this.audioContext.createMediaStreamSource(e),s=this.audioContext.createMediaStreamDestination();this.soundOriginGainNode=this.audioContext.createGain(),i.connect(this.soundOriginGainNode),this.soundOriginGainNode.connect(s),null==this.currentVolume?this.soundOriginGainNode.gain.value=1:this.soundOriginGainNode.gain.value=this.currentVolume;var o,r=s.stream,c=n(t);try{for(c.s();!(o=c.n()).done;){var d=o.value;r.addTrack(d)}}catch(h){c.e(h)}finally{c.f()}var l,u=n(a);try{for(u.s();!(l=u.n()).done;){var m=l.value;r.addTrack(m)}}catch(h){u.e(h)}finally{u.f()}return r}},{key:"switchAudioInputSource",value:function(e,t){var a=this.localStream.getAudioTracks()[0];a?a.stop():console.warn("There is no audio track in local stream"),"undefined"!=typeof t&&(!0!==this.mediaConstraints.audio?this.mediaConstraints.audio.deviceId=t:this.mediaConstraints.audio={deviceId:t}),this.setAudioInputSource(e,this.mediaConstraints,null,!0,t)}},{key:"switchVideoCameraCapture",value:function(e,t){var a=this.localStream.getVideoTracks()[0];a?a.stop():console.warn("There is no video track in local stream"),this.publishMode="camera","undefined"!=typeof t&&(!0!==this.mediaConstraints.video?this.mediaConstraints.video.deviceId={exact:t}:this.mediaConstraints.video={deviceId:{exact:t}}),this.setVideoCameraSource(e,this.mediaConstraints,null,!0,t)}},{key:"switchDesktopCaptureWithCamera",value:function(e){this.publishMode="screen+camera";var t=!1;"undefined"!=typeof this.mediaConstraints.audio&&0!=this.mediaConstraints.audio&&(t=this.mediaConstraints.audio),this.getUserMedia(this.mediaConstraints,t,e)}},{key:"updateLocalAudioStream",value:function(e,t){var a=e.getAudioTracks()[0];if(null!=this.localStream&&null!=this.localStream.getAudioTracks()[0]){var n=this.localStream.getAudioTracks()[0];this.localStream.removeTrack(n),n.stop(),this.localStream.addTrack(a)}else null!=this.localStream?this.localStream.addTrack(a):this.localStream=e;null!=this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getAudioTracks()[0].onended=function(e){t(e)})}},{key:"updateLocalVideoStream",value:function(e,t,a){a&&null!=this.desktopStream&&this.desktopStream.getVideoTracks()[0].stop();var n=e.getVideoTracks()[0];if(null!=this.localStream&&null!=this.localStream.getVideoTracks()[0]){var i=this.localStream.getVideoTracks()[0];this.localStream.removeTrack(i),i.stop(),this.localStream.addTrack(n)}else null!=this.localStream?this.localStream.addTrack(n):this.localStream=e;this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getVideoTracks()[0].onended=function(e){t(e)})}},{key:"setAudioInputSource",value:function(e,t,a){var n=this;this.navigatorUserMedia(t,(function(i){n.updateAudioTrack(i,e,t,a)}),!0)}},{key:"setVideoCameraSource",value:function(e,t,a,n){var i=this;this.navigatorUserMedia(t,(function(s){s=i.setGainNodeStream(s),i.updateVideoTrack(s,e,t,a,n),i.updateAudioTrack(s,e,t,a)}),!0)}},{key:"updateAudioTrack",value:function(e,t,a){var n=this;if(null!=this.remotePeerConnection[t]){var i=this.remotePeerConnection[t].getSenders().find((function(e){return"audio"==e.track.kind}));i?i.replaceTrack(e.getAudioTracks()[0]).then((function(t){n.updateLocalAudioStream(e,a)})).catch((function(e){console.log(e.name)})):console.error("AudioTrackSender is undefined or null")}else this.updateLocalAudioStream(e,a)}},{key:"updateVideoTrack",value:function(e,t,a,n,i){var s=this;if(null!=this.remotePeerConnection[t]){var o=this.remotePeerConnection[t].getSenders().find((function(e){return"video"==e.track.kind}));o?o.replaceTrack(e.getVideoTracks()[0]).then((function(t){s.updateLocalVideoStream(e,n,i)})).catch((function(e){console.log(e.name)})):console.error("VideoTrackSender is undefined or null")}else this.updateLocalVideoStream(e,n,i)}},{key:"getIndex",value:function(e){var t=null;return"video"==e.kind?t=e.id.replace("ARDAMSv",""):"audio"==e.kind&&(t=e.id.replace("ARDAMSa","")),t}},{key:"userTrack",value:function(){var e=r(i.mark((function e(t,a){var n,s,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.next=3,p.get("https://prematix.tech/WebRTCAppEE/rest/v2/broadcasts/".concat(t));case 3:return s=e.sent,o=JSON.parse(s.data.name),n.stream=new MediaStream,n.streamId=t,n.userName=o.hasOwnProperty("username")?o.username:null,n.socketId=o.hasOwnProperty("socketId")?o.socketId:null,n.audioTrack=this.multiStream.getTrackById("ARDAMSa"+t),n.videoTrack=this.multiStream.getTrackById("ARDAMSv"+t),n.audioTrack&&n.stream.addTrack(n.audioTrack),n.videoTrack&&n.stream.addTrack(n.videoTrack),e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"updateUserTrack",value:function(){var e=r(i.mark((function e(t,a){var n,s,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new MediaStream,s=this.multiStream.getTrackById("ARDAMSa"+t),o=this.multiStream.getTrackById("ARDAMSv"+t),this.MediaStreamList[t].audioTrack=s,this.MediaStreamList[t].videoTrack=o,s&&n.addTrack(s),o&&n.addTrack(o),this.MediaStreamList[t].stream=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"updateUserStreamDetails",value:function(){var e=r(i.mark((function e(t,a,n){var s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==window.roomId||t==window.publishStreamId){e.next=8;break}if(this.multiStream.addTrack(a),a.onmute=function(e){var a=!0;if(document.getElementById("remoteVideo"+t).srcObject.getTracks().forEach((function(e){e.muted||(console.log("muted",e.muted),a=!1)})),a){var n=s.MediaStreamList[t];s.multiStream.removeTrack(s.multiStream.getTrackById("ARDAMSv"+t)),s.multiStream.removeTrack(s.multiStream.getTrackById("ARDAMSa"+t)),delete s.MediaStreamList[t],s.callback("closePeer",{data:n})}},this.MediaStreamList[t]){e.next=8;break}return e.next=6,this.userTrack(t,a);case 6:this.MediaStreamList[t]=e.sent,n(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"onTrack",value:function(){var e=r(i.mark((function e(t,a){var n,s,o,c,d=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getIndex(t.track),e.next=3,this.updateUserStreamDetails(n,t.track,function(){var e=r(i.mark((function e(t){var a,n,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.callback("newStreamAvailable",{}),"",s=null===(a=d.recorder)||void 0===a||null===(n=a.streams)||void 0===n?void 0:n.find((function(e){return e.streamId==t})),!d.recorder||s){e.next=9;break}return e.next=6,window.webRTCAdaptor.recorder.addStream(d.MediaStreamList[t].stream,{Xindex:d.xindex,Yindex:d.yindex,streamId:t});case 6:3===d.xindex&&(d.yindex++,d.xindex=0),d.xindex++,d.oldId=t;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:if(null==this.remoteVideo){e.next=7;break}this.remoteVideo.srcObject!==t.streams[0]&&(this.remoteVideo.srcObject=t.streams[0]),e.next=20;break;case 7:if(!0!==this.micMute){e.next=17;break}e.t0=i.keys(this.remotePeerConnection);case 9:if((e.t1=e.t0()).done){e.next=15;break}return s=e.t1.value,o=s,e.abrupt("break",15);case 15:c={streamId:o,eventType:"MIC_MUTED",dbName:this.secToken},this.s.emit("micChange",c);case 17:!0!==this.isScreenShare&&!0!==this.isScreenShareAndCamera||(this.changeBandwidth(5e3,window.publishStreamId),this.s.emit("screensharing",{streamId:window.publishStreamId,dbName:this.secToken})),!0===this.isRecordingEnabled&&(c={streamId:window.publishStreamId,userName:window.UserName},this.s.emit("recording_start",c)),this.recorder&&this.oldId!==a&&(window.webRTCAdaptor.recorder.addStream(t.streams[0],{Xindex:this.xindex,Yindex:this.yindex,streamId:a}),3===this.xindex&&(this.yindex++,this.xindex=0),this.xindex++,this.oldId=a);case 20:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"iceCandidateReceived",value:function(e,t){if(e.candidate){var a=!1;if(""==e.candidate.candidate?a=!0:"undefined"==typeof e.candidate.protocol?this.candidateTypes.forEach((function(t){e.candidate.candidate.toLowerCase().includes(t)&&(a=!0)})):a=this.candidateTypes.includes(e.candidate.protocol.toLowerCase()),a){var n={command:"takeCandidate",streamId:t,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};this.debug&&(console.log("sending ice candiate for stream Id "+t),console.log(JSON.stringify(e.candidate))),this.webSocketAdaptor.send(JSON.stringify(n))}else console.log("Candidate's protocol(full sdp: "+e.candidate.candidate+") is not supported. Supported protocols: "+this.candidateTypes),""!=e.candidate.candidate&&this.callbackError("protocol_not_supported","Support protocols: "+this.candidateTypes.toString()+" candidate: "+e.candidate.candidate)}else console.log("No event.candidate in the iceCandidate event")}},{key:"initDataChannel",value:function(e,t){var a=this;t.onerror=function(n){console.log("Data Channel Error:",n);var i={streamId:e,error:n};console.log("channel status: ",t.readyState),"closed"!=t.readyState&&a.callbackError("data_channel_error",i)},t.onmessage=function(t){var n={streamId:e,data:t.data},i=n.data;if("string"===typeof i||i instanceof String)a.callback("data_received",n);else{var s=i.length||i.size||i.byteLength,o=new Int32Array(i,0,1)[0],r=a.receivingMessages[o];if(void 0==r){var c=new Int32Array(i,0,2)[1];return r=new ReceivingMessage(c),a.receivingMessages[o]=r,void(s>8&&console.error("something went wrong in msg receiving"))}var d=i.slice(4,s);new Uint8Array(r.data).set(new Uint8Array(d),r.received,s-4),r.received+=s-4,r.size==r.received&&(n.data=r.data,a.callback("data_received",n))}},t.onopen=function(){a.remotePeerConnection[e].dataChannel=t,console.log("Data channel is opened"),a.callback("data_channel_opened",e)},t.onclose=function(){console.log("Data channel is closed"),a.callback("data_channel_closed",e)}}},{key:"initPeerConnection",value:function(e,t){var a=this;if(null==this.remotePeerConnection[e]){var n=e;if(console.log("stream id in init peer connection: "+e+" close stream id: "+n),this.remotePeerConnection[e]=new RTCPeerConnection(this.peerconnection_config),this.remoteDescriptionSet[e]=!1,this.iceCandidateList[e]=new Array,this.playStreamId.includes(e)||null!=this.localStream&&this.remotePeerConnection[e].addStream(this.localStream),this.remotePeerConnection[e].onicecandidate=function(e){a.iceCandidateReceived(e,n)},this.remotePeerConnection[e].ontrack=function(e){a.onTrack(e,n)},this.remotePeerConnection[e].onnegotiationneeded=function(e){console.log("onnegotiationneeded")},this.dataChannelEnabled)if("publish"==t){if(this.remotePeerConnection[e].createDataChannel){var i=this.remotePeerConnection[e].createDataChannel(e,{ordered:!0});this.initDataChannel(e,i)}else console.warn("CreateDataChannel is not supported")}else if("play"==t)this.remotePeerConnection[e].ondatachannel=function(t){a.initDataChannel(e,t.channel)};else{if(this.remotePeerConnection[e].createDataChannel){var s=this.remotePeerConnection[e].createDataChannel(e,{ordered:!0});this.initDataChannel(e,s),this.remotePeerConnection[e].ondatachannel=function(t){a.initDataChannel(e,t.channel)}}else console.warn("CreateDataChannel is not supported")}this.remotePeerConnection[e].oniceconnectionstatechange=function(t){var n={state:a.remotePeerConnection[e].iceConnectionState,streamId:e};a.callback("ice_connection_state_changed",n),a.isPlayMode||"connected"==a.remotePeerConnection[e].iceConnectionState&&a.changeBandwidth(a.bandwidth,e).then((function(){console.log("Bandwidth is changed to "+a.bandwidth)})).catch((function(e){return console.warn(e)}))}}}},{key:"closePeerConnection",value:function(e){if(null!=this.remotePeerConnection[e]&&(null!=this.remotePeerConnection[e].dataChannel&&this.remotePeerConnection[e].dataChannel.close(),"closed"!=this.remotePeerConnection[e].signalingState)){this.remotePeerConnection[e].close(),this.remotePeerConnection[e]=null,delete this.remotePeerConnection[e];var t=this.playStreamId.indexOf(e);-1!=t&&this.playStreamId.splice(t,1)}null!=this.remotePeerConnectionStats[e]&&(clearInterval(this.remotePeerConnectionStats[e].timerId),delete this.remotePeerConnectionStats[e])}},{key:"signallingState",value:function(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].signalingState:null}},{key:"iceConnectionState",value:function(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].iceConnectionState:null}},{key:"gotDescription",value:function(e,t){var a=this;this.remotePeerConnection[t].setLocalDescription(e).then((function(n){console.debug("Set local description successfully for stream Id "+t);var i={command:"takeConfiguration",streamId:t,type:e.type,sdp:e.sdp};a.debug&&(console.debug("local sdp: "),console.debug(e.sdp)),a.webSocketAdaptor.send(JSON.stringify(i))})).catch((function(e){console.error("Cannot set local description. Error is: "+e)}))}},{key:"initializeDummyFrame",value:function(){this.dummyCanvas.getContext("2d").drawImage(document.getElementById("posterImgId"),0,0,315,150),this.replacementStream=this.dummyCanvas.captureStream()}},{key:"turnOffLocalCamera",value:function(e){if(this.isCameraOn=!1,this.initializeDummyFrame(),null!=this.remotePeerConnection){var t;if(t=null!=e||"undefined"!=typeof e?e:this.publishStreamId,console.log("Turn off check",this.isRecordingEnabled,this.backgroundChangeVar,this.isRecordingEnabled&&this.backgroundChangeVar),this.isRecordingEnabled&&this.backgroundChangeVar){console.log("turnOfLocalCamera: isRecordingEnabled");var a=new MediaStream,n=this.replacementStream.getVideoTracks()[0];a.addTrack(n),a.addTrack(this.tempStream.getAudioTracks()[0]),console.log("turnOf temp stream",a),this.recorder.streams[0].element.srcObject=a;var i=this.tempStream.getVideoTracks()[0];console.log("turnof rmtrack ",i),this.tempStream.removeTrack(i),i.stop(),this.tempStream.addTrack(n);var s=this.remotePeerConnection[t].getSenders().find((function(e){return"video"==e.track.kind}));if(console.log("turnOf videoTrackSender",s),s){s.replaceTrack(this.replacementStream.getVideoTracks()[0]),console.log("turnOf videoTrackSender changed");var o=new MediaStream;o.addTrack(this.replacementStream.getVideoTracks()[0]),o.addTrack(this.tempStream.getAudioTracks()[0]),this.localVideo.srcObject=o}}else this.updateVideoTrack(this.replacementStream,t,this.mediaConstraints,null,!0);return!0}return this.callbackError("NoActiveConnection"),!1}},{key:"turnOnLocalCamera",value:function(e){var t=this;if(this.isCameraOn=!0,null!=this.blackFrameTimer&&(clearInterval(this.blackFrameTimer),this.blackFrameTimer=null),null!=this.localStream)return null!=this.remotePeerConnection?(this.navigatorUserMedia(this.mediaConstraints,(function(a){var n;if(n=null!=e||"undefined"!=typeof e?e:t.publishStreamId,console.log("Turn on check",t.isRecordingEnabled,t.backgroundChangeVar,t.isRecordingEnabled&&t.backgroundChangeVar),t.isRecordingEnabled&&t.backgroundChangeVar){console.log("turnOnLocalCamera: isRecordingEnabled");var i=new MediaStream;i.addTrack(t.localStream.getVideoTracks()[0]),i.addTrack(t.tempStream.getAudioTracks()[0]),console.log("turnOn temp stream",i),t.recorder.streams[0].element.srcObject=i;var s=t.remotePeerConnection[n].getSenders().find((function(e){return"video"==e.track.kind}));if(console.log("turnOn videoTrackSender",s),s){s.replaceTrack(t.localStream.getVideoTracks()[0]),console.log("turnOn videoTrackSender changed");var o=new MediaStream;o.addTrack(a.getVideoTracks()[0]),o.addTrack(t.tempStream.getAudioTracks()[0]),t.localVideo.srcObject=o}var r=t.tempStream.getVideoTracks()[0];console.log("turnon rmtrack ",r)}else t.updateVideoTrack(a,n,t.mediaConstraints,null,!0)}),!1),!0):(this.callbackError("NoActiveConnection"),!1);this.navigatorUserMedia(this.mediaConstraints,(function(e){t.gotStream(e)}),!1)}},{key:"muteLocalMic",value:function(e){try{if(null!=this.remotePeerConnection){this.localStream.getAudioTracks()[0].enabled=!1,this.remotePeerConnection[window.publishStreamId].getSenders().map((function(e){"audio"==e.track.kind&&(e.track.enabled=!1)})),this.isMicOn=!1;var t={streamId:e,eventType:"MIC_MUTED",dbName:this.secToken};return this.s.emit("micChange",t),this.micMute=!0,!0}return this.callbackError("NoActiveConnection"),!0}catch(a){return this.callbackError("No Local Mic Found"),!1}}},{key:"unmuteLocalMic",value:function(e){try{if(null!=this.remotePeerConnection){this.localStream.getAudioTracks()[0].enabled=!0,this.remotePeerConnection[window.publishStreamId].getSenders().map((function(e){"audio"==e.track.kind&&(e.track.enabled=!0)})),this.isMicOn=!0;var t={streamId:e,eventType:"MIC_UNMUTED",dbName:this.secToken};return this.s.emit("micChange",t),this.micMute=!1,!0}return this.callbackError("NoActiveConnection"),!1}catch(a){return this.callbackError("No Local Mic Found"),!1}}},{key:"changeVolume",value:function(e){this.currentVolume=e,null!=this.soundOriginGainNode&&(this.soundOriginGainNode.gain.value=e),null!=this.secondStreamGainNode&&(this.secondStreamGainNode.gain.value=e)}},{key:"showRaiseHand",value:function(e,t,a){this.handRaise=!this.handRaise;var n={streamId:e,userName:a,partEmoji:t,dbName:this.secToken};this.s.emit("handRaise",n)}},{key:"takeConfiguration",value:function(e,t,a,n){var i=this,s=e,o=a,r=t,c="offer"==o,d="publish";c&&(d="play"),this.idMapping[s]=n,this.initPeerConnection(s,d),this.remotePeerConnection[s].setRemoteDescription(new RTCSessionDescription({sdp:r,type:o})).then((function(e){i.debug&&(console.debug("set remote description is succesfull with response: "+e+" for stream : "+s+" and type: "+o),console.debug(r)),i.remoteDescriptionSet[s]=!0;var t=i.iceCandidateList[s].length;console.debug("Ice candidate list size to be added: "+t);for(var a=0;a<t;a++)i.addIceCandidate(s,i.iceCandidateList[s][a]);i.iceCandidateList[s]=[],c&&(console.log("try to create answer for stream id: "+s),i.remotePeerConnection[s].createAnswer(i.sdp_constraints).then((function(e){console.log("created answer for stream id: "+s),e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1"),i.gotDescription(e,s)})).catch((function(e){console.error("create answer error :"+e)})))})).catch((function(e){i.debug&&console.error("set remote description is failed with error: "+e),(e.toString().indexOf("InvalidAccessError")>-1||e.toString().indexOf("setRemoteDescription")>-1)&&i.callbackError("notSetRemoteDescription")}))}},{key:"takeCandidate",value:function(e,t,a){var n=e,i=new RTCIceCandidate({sdpMLineIndex:t,candidate:a});this.initPeerConnection(n,"peer"),1==this.remoteDescriptionSet[n]?this.addIceCandidate(n,i):(console.debug("Ice candidate is added to list because remote description is not set yet"),this.iceCandidateList[n].push(i))}},{key:"addIceCandidate",value:function(e,t){var a=this,n=!1;""==t.candidate?n=!0:"undefined"==typeof t.protocol?this.candidateTypes.forEach((function(e){t.candidate.toLowerCase().includes(e)&&(n=!0)})):n=this.candidateTypes.includes(t.protocol.toLowerCase()),n?this.remotePeerConnection[e].addIceCandidate(t).then((function(t){a.debug&&console.log("Candidate is added for stream "+e)})).catch((function(a){console.error("ice candiate cannot be added for stream id: "+e+" error is: "+a),console.error(t)})):this.debug&&console.log("Candidate's protocol("+t.protocol+") is not supported.Candidate: "+t.candidate+" Supported protocols:"+this.candidateTypes)}},{key:"startPublishing",value:function(e){var t=this,a=e;this.initPeerConnection(a,"publish"),this.remotePeerConnection[a].createOffer(this.sdp_constraints).then((function(e){t.gotDescription(e,a)})).catch((function(e){console.error("create offer error for stream id: "+a+" error: "+e)}))}},{key:"getVideoSender",value:function(e){var t=null;if(("chrome"===u.browserDetails.browser||"firefox"===u.browserDetails.browser||"safari"===u.browserDetails.browser&&u.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&null!=this.remotePeerConnection[e])for(var a=this.remotePeerConnection[e].getSenders(),n=0;n<a.length;n++)if(null!=a[n].track&&"video"==a[n].track.kind){t=a[n];break}return t}},{key:"changeBandwidth",value:function(e,t){var a="",n=this.getVideoSender(t);if(null!=n){var i=n.getParameters();return i.encodings||(i.encodings=[{}]),"unlimited"===e?delete i.encodings[0].maxBitrate:i.encodings[0].maxBitrate=1e3*e,n.setParameters(i)}return a="Video sender not found to change bandwidth. Streaming may not be active",Promise.reject(a)}},{key:"getStats",value:function(e){var t=this;console.log("peerstatsgetstats = "+this.remotePeerConnectionStats[e]),this.remotePeerConnection[e].getStats(null).then((function(a){var n=-1,i=-1,s=-1,o=-1,r=-1,c=-1,d=-1,l="",u=-1,m=-1,h=-1,p=-1,v=-1,f=-1,g=-1,b=-1,w=-1,y=-1,k=-1,S=-1,j=-1,x=-1,C=-1;a.forEach((function(e){"inbound-rtp"==e.type&&"undefined"!=typeof e.kind?(n+=e.bytesReceived,"audio"==e.kind?s=e.packetsLost:"video"==e.kind&&(i=e.packetsLost),o+=e.fractionLost,r=e.timestamp):"outbound-rtp"==e.type?(c+=e.bytesSent,r=e.timestamp,l=e.qualityLimitationReason,null!=e.framesEncoded&&(u+=e.framesEncoded)):"track"==e.type&&"undefined"!=typeof e.kind&&"audio"==e.kind?("undefined"!=typeof e.audioLevel&&(d=e.audioLevel),"undefined"!=typeof e.jitterBufferDelay&&"undefined"!=typeof e.jitterBufferEmittedCount&&(x=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"track"==e.type&&"undefined"!=typeof e.kind&&"video"==e.kind?("undefined"!=typeof e.frameWidth&&(v=e.frameWidth),"undefined"!=typeof e.frameHeight&&(f=e.frameHeight),"undefined"!=typeof e.framesDecoded&&(k=e.framesDecoded),"undefined"!=typeof e.framesDropped&&(S=e.framesDropped),"undefined"!=typeof e.framesReceived&&(j=e.framesReceived),"undefined"!=typeof e.jitterBufferDelay&&"undefined"!=typeof e.jitterBufferEmittedCount&&(C=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"remote-inbound-rtp"==e.type&&"undefined"!=typeof e.kind?("undefined"!=typeof e.packetsLost&&("video"==e.kind?i=e.packetsLost:"audio"==e.kind&&(s=e.packetsLost)),"undefined"!=typeof e.roundTripTime&&("video"==e.kind?g=e.roundTripTime:"audio"==e.kind&&(w=e.roundTripTime)),"undefined"!=typeof e.jitter&&("video"==e.kind?b=e.jitter:"audio"==e.kind&&(y=e.jitter))):"media-source"==e.type&&"video"==e.kind&&(m=e.width,h=e.height,p=e.framesPerSecond)})),t.remotePeerConnectionStats[e].totalBytesReceived=n,t.remotePeerConnectionStats[e].videoPacketsLost=i,t.remotePeerConnectionStats[e].audioPacketsLost=s,t.remotePeerConnectionStats[e].fractionLost=o,t.remotePeerConnectionStats[e].currentTime=r,t.remotePeerConnectionStats[e].totalBytesSent=c,t.remotePeerConnectionStats[e].audioLevel=d,t.remotePeerConnectionStats[e].qualityLimitationReason=l,t.remotePeerConnectionStats[e].totalFramesEncoded=u,t.remotePeerConnectionStats[e].resWidth=m,t.remotePeerConnectionStats[e].resHeight=h,t.remotePeerConnectionStats[e].srcFps=p,t.remotePeerConnectionStats[e].frameWidth=v,t.remotePeerConnectionStats[e].frameHeight=f,t.remotePeerConnectionStats[e].videoRoundTripTime=g,t.remotePeerConnectionStats[e].videoJitter=b,t.remotePeerConnectionStats[e].audioRoundTripTime=w,t.remotePeerConnectionStats[e].audioJitter=y,t.remotePeerConnectionStats[e].framesDecoded=k,t.remotePeerConnectionStats[e].framesDropped=S,t.remotePeerConnectionStats[e].framesReceived=j,t.remotePeerConnectionStats[e].videoJitterAverageDelay=C,t.remotePeerConnectionStats[e].audioJitterAverageDelay=x,t.callback("updated_stats",t.remotePeerConnectionStats[e])}))}},{key:"disableStats",value:function(e){null==this.remotePeerConnectionStats[e]&&"undefined"==typeof this.remotePeerConnectionStats[e]||clearInterval(this.remotePeerConnectionStats[e].timerId)}},{key:"enableStats",value:function(e){var t=this;null==this.remotePeerConnectionStats[e]&&(this.remotePeerConnectionStats[e]=new c(e),this.remotePeerConnectionStats[e].timerId=setInterval((function(){t.getStats(e)}),5e3))}},{key:"closeWebSocket",value:function(){for(var e in this.remotePeerConnection)this.remotePeerConnection[e].close();this.remotePeerConnection=new Array,this.webSocketAdaptor.close()}},{key:"checkWebSocketConnection",value:function(){(null==this.webSocketAdaptor||0==this.webSocketAdaptor.isConnected()&&0==this.webSocketAdaptor.isConnecting())&&(this.webSocketAdaptor=new l({websocket_url:this.websocket_url,webrtcadaptor:this,callback:this.callback,callbackError:this.callbackError,debug:this.debug}))}},{key:"peerMessage",value:function(e,t,a){var n={command:"peerMessageCommand",streamId:e,definition:t,data:a};this.webSocketAdaptor.send(JSON.stringify(n))}},{key:"forceStreamQuality",value:function(e,t){var a={command:"forceStreamQuality",streamId:e,streamHeight:t};this.webSocketAdaptor.send(JSON.stringify(a))}},{key:"sendData",value:function(e,t){var a=this.remotePeerConnection[e].dataChannel,n=t.length||t.size||t.byteLength,i=0;if("string"===typeof t||t instanceof String)a.send(t);else{var s=Math.floor(999999*Math.random()),o=new Int32Array(2);o[0]=s,o[1]=n,a.send(o);for(i=0;i<n;){var r=Math.min(n-i,16e3),c=new Uint8Array(r+4),d=new Int32Array(1);d[0]=s,c.set(new Uint8Array(d.buffer,0,4),0);var l=t.slice(i,i+r);c.set(new Uint8Array(l),4),i+=r,a.send(c)}}}},{key:"enableRecording",value:function(e,t){var a=this;if(this.isRecordingEnabled=!0,this.isRecordingEnabled){this.recorder=new d(320,240,!0,"4:3");var n={streamId:e,userName:t};this.s.emit("recording_start",n),this.recorder.start(),null!=this.localStream&&(this.recorder.addStream(this.localStream,{Xindex:this.xindex,Yindex:this.yindex,streamId:e}),3==this.xindex&&(this.yindex++,this.xindex=0),this.xindex++),Object.keys(this.MediaStreamList).forEach((function(e){var t=new MediaStream;a.multiStream.getTrackById("ARDAMSv"+a.MediaStreamList[e].streamId)&&t.addTrack(a.multiStream.getTrackById("ARDAMSv"+a.MediaStreamList[e].streamId)),a.multiStream.getTrackById("ARDAMSa"+a.MediaStreamList[e].streamId)&&t.addTrack(a.multiStream.getTrackById("ARDAMSa"+a.MediaStreamList[e].streamId)),a.recorder.addStream(t,{Xindex:a.xindex,Yindex:a.yindex,streamId:e}),3==a.xindex&&(a.yindex++,a.xindex=0),a.xindex++}));return this.mediaRecorder=new MediaRecorder(this.recorder.result,{mimeType:"video/webm; codecs=vp9"}),this.mediaRecorder.ondataavailable=this.handleRecorderData,this.mediaRecorder.start(),!0}return this.callbackError("Already is Enabled!"),!1}},{key:"handleRecorderData",value:function(e){if(this.recordedChunks=new Array,e.data.size>0){this.recordedChunks.push(e.data);var t=new Blob(this.recordedChunks,{type:"video/webm"}),a=URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=a,n.download="test.webm",n.click(),window.URL.revokeObjectURL(a)}else console.log(recordedChunks)}},{key:"disableRecording",value:function(){try{if(this.isRecordingEnabled){this.isRecordingEnabled=!1,this.recorder.stop(),this.mediaRecorder.stop(),this.xindex=0,this.yindex=0;var e={streamId:window.publishStreamId,userName:window.UserName};return this.s.emit("recording_stop",e),console.log("Recording Stopped. The vedio will be downloaded after few seconds."),!0}return this.callbackError("No Recording is on Process."),!1}catch(t){return!1}}},{key:"backgroundModel",value:function(){var e=this;document.getElementById("localVideo").onloadeddata=function(t){console.log("Yay! The readyState just increased to  HAVE_CURRENT_DATA or greater for the first time."),null==e.net&&(console.log("Loading this config"),h.load({architecture:"MobileNetV1",outputStride:8,multiplier:.75,quantBytes:2}).catch((function(e){console.log(e)})).then((function(t){e.net=t})))}}},{key:"backgroundChangeCl",value:function(){window.webRTCAdaptor.backgroundChangeVar=!0,document.getElementById("localVideoCanvas").style.display="block",this.detectBody(),this.updateBackgroundStream()}},{key:"updateBackgroundStream",value:function(){var e=document.getElementById("localVideoCanvas").captureStream(),t=window.webRTCAdaptor.remotePeerConnection[window.publishStreamId].getSenders().find((function(e){return"video"==e.track.kind}));if(e.getVideoTracks()[0]){console.log("checkCanvasStream",t),t.replaceTrack(e.getVideoTracks()[0]);var a=new MediaStream;a.addTrack(e.getVideoTracks()[0]),a.addTrack(this.localStream.getAudioTracks()[0]),this.tempStream=this.localStream,this.localStream=a,this.isRecordingEnabled&&(this.recorder.streams[0].element.srcObject=a)}else console.log("came to else update background stream"),setTimeout((function(){this.updateBackgroundStream()}),1e3)}},{key:"removeBackground",value:function(){window.webRTCAdaptor.backgroundChangeVar=!1,"none"===document.getElementById("localVideo").style.display&&(document.getElementById("localVideo").style.display=""),document.getElementById("localVideoCanvas").style.display="none";var e=document.getElementById("localVideo").captureStream();window.webRTCAdaptor.remotePeerConnection[window.publishStreamId].getSenders().find((function(e){return"video"==e.track.kind})).replaceTrack(e.getVideoTracks()[0]),this.tempStream&&(this.localStream=this.tempStream,this.tempStream=null),this.isRecordingEnabled&&(window.webRTCAdaptor.recorder.streams[0].element.srcObject=this.localStream)}},{key:"detectBody",value:function(){var e=r(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=window.webRTCAdaptor.backgroundChangeVar){e.next=9;break}if(null==window.webRTCAdaptor.net){e.next=8;break}return window.webRTCAdaptor.backgroundChangeVar,e.next=5,document.getElementById("localVideo");case 5:return t=e.sent,e.next=8,window.webRTCAdaptor.net.segmentPerson(t,{flipHorizontal:!1,internalResolution:"low",segmentationThreshold:.33}).then((function(e){window.webRTCAdaptor.drawBody(e)})).catch((function(e){console.log(e)}));case 8:window.webRTCAdaptor.requestFrameId=requestAnimationFrame(window.webRTCAdaptor.detectBody);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"drawBody",value:function(e){var t=document.getElementById("localVideo"),a=document.getElementById("localVideoCanvas"),n=document.getElementById("canvasSecId"),i=532,s=400;a.getContext("2d").drawImage(t,0,0,i,s);var o=a.getContext("2d").getImageData(0,0,i,s).data,r=document.getElementById("bacImg");n.getContext("2d").drawImage(r,0,0,i,s);for(var c=n.getContext("2d").getImageData(0,0,i,s),d=c.data,l=0;l<o.length;l+=4)0==e.data[l/4]?o[l+3]=0:d[l+3]=0;n.getContext("2d").imageSmoothingEnabled=!0,n.getContext("2d").putImageData(c,0,0),a.getContext("2d").drawImage(n,0,0,i,s)}},{key:"stopScreenShare",value:function(e){var t=this;this.backgroundChangeVar&&this.backgroundChangeCl(),navigator.mediaDevices.getUserMedia({video:!0}).then((function(a){a.onended=function(){console.log("screenshare on ended call")},t.newScreenStream.getVideoTracks()[0].stop();var n=t.remotePeerConnection[window.publishStreamId].getSenders().find((function(e){return"video"==e.track.kind}));console.log("checkPeerStream",n),t.initializeDummyFrame();var i=t.dummyCanvas.captureStream(),s=t.isCameraOn?a.getVideoTracks()[0]:i.getVideoTracks()[0];console.log("videoTrack",s),n.replaceTrack(s);var o=new MediaStream;o.addTrack(s),o.addTrack(t.localStream.getAudioTracks()[0]),document.querySelector(t.localVideoId).srcObject=o,console.log("newStopStream",o.getVideoTracks()[0]),t.localStream=o,t.isScreenShareAndCamera=!1,t.isScreenShare=!1,t.s.emit("stop_screensharing",{streamId:e,dbName:t.secToken}),t.callback("screen_share_stopped"),t.isRecordingEnabled&&(t.recorder.streams[0].element.srcObject=o)})).catch((function(e){console.log("stop screen share err",e)}))}},{key:"startScreenShare",value:function(e){var t=this;console.log("start screen share"),this.isScreenShare=!0,this.isScreenShareAndCamera=!0,navigator.mediaDevices.getDisplayMedia({video:{width:4096,height:2160},audio:!1}).then((function(a){a.getVideoTracks()[0].onended=function(){console.log("onended called video"),t.stopScreenShare(e)};var n=t.remotePeerConnection[e].getSenders().find((function(e){return"video"==e.track.kind})),i=new MediaStream;i.addTrack(a.getVideoTracks()[0]),i.addTrack(t.localStream.getAudioTracks()[0]),document.querySelector(t.localVideoId).srcObject=i,n.replaceTrack(a.getVideoTracks()[0]),t.newScreenStream=a;var s=t.localStream.getVideoTracks()[0];t.localStream=i,s.stop(),t.s.emit("screensharing",{streamId:e,dbName:t.secToken}),t.callback("screen_share_started"),console.log("start screen share",t.newScreenStream),t.isRecordingEnabled&&(t.recorder.streams[0].element.srcObject=i)})).catch((function(e){console.log("start screen share",e)}))}},{key:"encryptMessage",value:function(e){return v.AES.encrypt(e,this.secToken).toString()}},{key:"decryptMessage",value:function(e){return v.AES.decrypt(e,this.secToken).toString(v.enc.Utf8)}}]),e}();function b(e){this.context=e,this.instant=0,this.slow=0,this.clip=0,this.script=e.createScriptProcessor(2048,1,1);var t=this;this.script.onaudioprocess=function(e){var a,n=e.inputBuffer.getChannelData(0),i=0,s=0;for(a=0;a<n.length;++a)i+=n[a]*n[a],Math.abs(n[a])>.99&&(s+=1);t.instant=Math.sqrt(i/n.length),t.slow=.95*t.slow+.05*t.instant,t.clip=s/n.length}}b.prototype.connectToSource=function(e,t){console.log("SoundMeter connecting");try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),"undefined"!==typeof t&&t(null)}catch(a){console.error(a),"undefined"!==typeof t&&t(a)}},b.prototype.stop=function(){console.log("SoundMeter stopping"),this.mic.disconnect(),this.script.disconnect()},e.exports={WebRTCAdaptor:g,SoundMeter:b,checkMicSensitivity:function(e,t){window.audioContext=new AudioContext;var a=window.soundMeter=new b(window.audioContext);a.connectToSource(e,(function(e){if(e)console.log(e);else var n=setInterval((function(){var e=document.querySelector("#remoteSpeaker".concat(t)),i=a.instant.toFixed(2);e&&i>=.01?e.style.display="block":e?e.style.display="none":clearInterval(n)}),800)}))},defaultErrorCallback:function(e,t){-1!=e.indexOf("publishTimeoutError")&&null!=window.roomTimerId&&clearInterval(window.roomTimerId);var a=JSON.stringify(e);"undefined"!=typeof t&&(a=t),a=JSON.stringify(e),-1!=e.indexOf("NotFoundError")?a="Camera or Mic are not found or not allowed in your device.":-1!=e.indexOf("NotReadableError")||-1!=e.indexOf("TrackStartError")?a="Camera or Mic is being used by some other process that does not not allow these devices to be read.":-1!=e.indexOf("OverconstrainedError")||-1!=e.indexOf("ConstraintNotSatisfiedError")?a="There is no device found that fits your video and audio constraints. You may change video and audio constraints.":-1!=e.indexOf("NotAllowedError")||-1!=e.indexOf("PermissionDeniedError")?a="You are not allowed to access camera and mic.":-1!=e.indexOf("TypeError")?a="Video/Audio is required.":-1!=e.indexOf("UnsecureContext")?a="Fatal Error: Browser cannot access camera and mic because of unsecure context. Please install SSL and access via https":-1!=e.indexOf("WebSocketNotSupported")?a="Fatal Error: WebSocket not supported in this browser":-1!=e.indexOf("no_stream_exist")||(-1!=e.indexOf("data_channel_error")?a="There was a error during data channel communication":-1!=e.indexOf("ScreenSharePermissionDenied")&&(a="You are not allowed to access screen share")),console.log(a)},publish:function(e,t,a,n){window.publishStreamId=t,e.publish(t,a,"","",n,window.roomId)},streamInformation:function(e,t){e.play(t.streamId,window.token,window.roomId)},playVideo:function(e){return f.apply(this,arguments)},reInit:function(e){var t=window.webRTCAdaptor.callback,a=window.webRTCAdaptor.callbackError;window.webRTCAdaptor.stop(publishStreamId),window.webRTCAdaptor.closePeerConnection(publishStreamId),window.webRTCAdaptor.closeWebSocket(),window.webRTCAdaptor=new g({isConnectionRefreshEnabled:!0,mediaConstraints:{video:!0,audio:!0},localVideoId:"#localVideo",ioPath:"https://saveme.ai/",callback:t,callbackError:a})},getHandRaiseEmojiTag:function(e,t){("Thumbsup"==e||"Heart"==e)&&(document.getElementById(t).style.display="block"),setTimeout((function(){document.getElementById(t).style.display="none"}),4e3)},handleNotificationEvent:function(e){var t=e;if(null!=t&&"object"==typeof t){var a=t.streamId,n=t.eventType;if("MIC_MUTED"==n){var i="mmute"+a,s="munmute"+a;try{document.getElementById(s).style.display="none",document.getElementById(i).style.display="block",document.getElementById("munmutescreenDiv").style.display="none",document.getElementById("mmutescreenDiv").style.display="block"}catch(c){console.log("error",c)}}else if("MIC_UNMUTED"==n){i="mmute"+a,s="munmute"+a;try{document.getElementById(i).style.display="none",document.getElementById(s).style.display="block",document.getElementById("munmutescreenDiv").style.display="none",document.getElementById("mmutescreenDiv").style.display="block"}catch(c){console.log("unmute error",c)}}else if("PARTICIPANT"==n){var o=0,r=[];for(user in a)"undefined"!==typeof a[user].userName&&(o++,r.push({userName:a[user].userName,streamId:a[user].streamId}));return[r,o]}}}}}},[[698,1,2]]]);
//# sourceMappingURL=main.97cf60fd.chunk.js.map